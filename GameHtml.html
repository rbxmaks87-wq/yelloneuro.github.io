<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML5 GAME HUB - Play Free Browser Games</title>
  <meta name="description" content="Discover, play, and share HTML5 games directly in your browser">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ============================================
       CSS VARIABLES & RESET
       ============================================ */
    :root {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --bg-tertiary: #2a2a2a;
      --bg-card: #252525;
      --text-primary: #e0e0e0;
      --text-secondary: #a0a0a0;
      --text-muted: #666;
      --accent: #00bfff;
      --accent-hover: #00a0d4;
      --accent-glow: rgba(0, 191, 255, 0.3);
      --success: #4caf50;
      --warning: #ff9800;
      --error: #f44336;
      --star: #ffc107;
      --border: #333;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      --radius: 12px;
      --radius-sm: 8px;
      --transition: 0.3s ease;
      --header-height: 70px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Focus styles for accessibility */
    :focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    a {
      color: var(--accent);
      text-decoration: none;
      transition: color var(--transition);
    }

    a:hover {
      color: var(--accent-hover);
    }

    button {
      cursor: pointer;
      font-family: inherit;
      border: none;
      background: none;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    /* ============================================
       UTILITY CLASSES
       ============================================ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 14px;
      transition: all var(--transition);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-primary {
      background: var(--accent);
      color: #000;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      box-shadow: 0 0 20px var(--accent-glow);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
      border-color: var(--accent);
    }

    .btn-icon {
      padding: 10px;
      border-radius: 50%;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 12px;
    }

    /* ============================================
       HEADER
       ============================================ */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
      gap: 20px;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 20px var(--accent-glow);
      white-space: nowrap;
    }

    .logo span {
      color: var(--text-primary);
    }

    nav {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav a {
      padding: 10px 16px;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--transition);
    }

    nav a:hover,
    nav a.active {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    nav a.active {
      color: var(--accent);
    }

    .search-container {
      position: relative;
      flex: 1;
      max-width: 400px;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text-primary);
      font-size: 14px;
      transition: all var(--transition);
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #9c27b0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--transition);
    }

    .user-avatar:hover {
      transform: scale(1.1);
    }

    .hamburger {
      display: none;
      flex-direction: column;
      gap: 5px;
      padding: 10px;
      cursor: pointer;
    }

    .hamburger span {
      width: 25px;
      height: 3px;
      background: var(--text-primary);
      border-radius: 2px;
      transition: all var(--transition);
    }

    /* ============================================
       MAIN LAYOUT
       ============================================ */
    .app-container {
      display: flex;
      margin-top: var(--header-height);
      min-height: calc(100vh - var(--header-height));
    }

    main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    aside {
      width: 300px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border);
      padding: 30px 20px;
      overflow-y: auto;
      position: sticky;
      top: var(--header-height);
      height: calc(100vh - var(--header-height));
    }

    /* ============================================
       HERO CAROUSEL
       ============================================ */
    .hero {
      position: relative;
      height: 400px;
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 40px;
    }

    .carousel {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .carousel-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.5s ease;
      background-size: cover;
      background-position: center;
    }

    .carousel-slide.active {
      opacity: 1;
    }

    .carousel-slide::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, rgba(18, 18, 18, 0.95), rgba(18, 18, 18, 0.3));
    }

    .carousel-content {
      position: absolute;
      left: 50px;
      bottom: 50px;
      max-width: 500px;
      z-index: 1;
    }

    .carousel-badge {
      display: inline-block;
      padding: 6px 12px;
      background: var(--accent);
      color: #000;
      font-size: 12px;
      font-weight: 700;
      border-radius: 4px;
      margin-bottom: 15px;
      text-transform: uppercase;
    }

    .carousel-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .carousel-desc {
      color: var(--text-secondary);
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    .carousel-nav {
      position: absolute;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 2;
    }

    .carousel-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
    }

    .carousel-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }

    .carousel-arrows {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 2;
      pointer-events: none;
    }

    .carousel-arrow {
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      cursor: pointer;
      pointer-events: auto;
      transition: all var(--transition);
    }

    .carousel-arrow:hover {
      background: var(--accent);
      color: #000;
    }

    /* ============================================
       SECTION HEADERS
       ============================================ */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: var(--accent);
      border-radius: 2px;
    }

    .view-all {
      font-size: 14px;
      font-weight: 500;
    }

    /* ============================================
       GAME CARDS GRID
       ============================================ */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
    }

    .game-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all var(--transition);
      border: 1px solid var(--border);
      position: relative;
    }

    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
      border-color: var(--accent);
    }

    .game-thumbnail {
      position: relative;
      height: 160px;
      background: var(--bg-tertiary);
      overflow: hidden;
    }

    .game-thumbnail canvas,
    .game-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .game-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity var(--transition);
    }

    .game-card:hover .game-overlay {
      opacity: 1;
    }

    .play-btn-large {
      width: 60px;
      height: 60px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-size: 24px;
      transform: scale(0.8);
      transition: transform var(--transition);
    }

    .game-card:hover .play-btn-large {
      transform: scale(1);
    }

    .game-info {
      padding: 15px;
    }

    .game-genre {
      display: inline-block;
      padding: 4px 10px;
      background: var(--bg-tertiary);
      color: var(--accent);
      font-size: 11px;
      font-weight: 600;
      border-radius: 4px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .game-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .game-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .game-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--star);
    }

    .game-plays {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .game-actions {
      display: flex;
      gap: 10px;
      padding: 0 15px 15px;
    }

    .game-actions .btn {
      flex: 1;
    }

    .favorite-btn {
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      transition: all var(--transition);
    }

    .favorite-btn:hover,
    .favorite-btn.active {
      color: var(--error);
      background: rgba(244, 67, 54, 0.1);
    }

    /* ============================================
       CATALOG FILTERS
       ============================================ */
    .catalog-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--bg-secondary);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .filter-select,
    .filter-input {
      padding: 10px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 14px;
      min-width: 150px;
      cursor: pointer;
    }

    .filter-select:focus,
    .filter-input:focus {
      border-color: var(--accent);
    }

    .genre-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      flex: 1;
    }

    .genre-chip {
      padding: 8px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all var(--transition);
    }

    .genre-chip:hover,
    .genre-chip.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }

    /* ============================================
       PAGINATION
       ============================================ */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 40px;
    }

    .page-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--transition);
    }

    .page-btn:hover,
    .page-btn.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ============================================
       GAME DETAIL PAGE
       ============================================ */
    .game-detail {
      max-width: 1000px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      transition: color var(--transition);
    }

    .back-btn:hover {
      color: var(--accent);
    }

    .game-header {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
    }

    .game-preview {
      width: 400px;
      height: 250px;
      background: var(--bg-tertiary);
      border-radius: var(--radius);
      overflow: hidden;
      flex-shrink: 0;
    }

    .game-preview canvas,
    .game-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .game-header-info {
      flex: 1;
    }

    .game-header-info .game-genre {
      margin-bottom: 15px;
    }

    .game-header-info h1 {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }

    .game-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      margin-bottom: 20px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .game-header-actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .game-player {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 30px;
    }

    .player-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
    }

    .player-title {
      font-weight: 600;
    }

    .player-controls {
      display: flex;
      gap: 10px;
    }

    .player-frame {
      width: 100%;
      height: 500px;
      border: none;
      background: #000;
    }

    .game-description {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 25px;
      margin-bottom: 30px;
    }

    .game-description h3 {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .controls-guide {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
    }

    .control-item {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .control-key {
      padding: 8px 12px;
      background: var(--bg-primary);
      border-radius: 6px;
      font-family: monospace;
      font-size: 13px;
      border: 1px solid var(--border);
    }

    /* ============================================
       EMBED CODE SECTION
       ============================================ */
    .embed-section {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 25px;
      margin-bottom: 30px;
    }

    .embed-section h3 {
      margin-bottom: 15px;
    }

    .embed-code {
      position: relative;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      padding: 20px;
      font-family: monospace;
      font-size: 13px;
      color: var(--accent);
      overflow-x: auto;
      border: 1px solid var(--border);
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    /* ============================================
       COMMENTS SECTION
       ============================================ */
    .comments-section {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 25px;
    }

    .comments-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 25px;
    }

    .comment-form {
      margin-bottom: 30px;
    }

    .comment-input {
      width: 100%;
      min-height: 100px;
      padding: 15px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 15px;
    }

    .comment-input:focus {
      border-color: var(--accent);
    }

    .comment-actions {
      display: flex;
      justify-content: flex-end;
    }

    .comment {
      display: flex;
      gap: 15px;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
    }

    .comment:last-child {
      border-bottom: none;
    }

    .comment-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .comment-content {
      flex: 1;
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .comment-author {
      font-weight: 600;
    }

    .comment-date {
      font-size: 12px;
      color: var(--text-muted);
    }

    .comment-rating {
      margin-left: auto;
      display: flex;
      gap: 2px;
      color: var(--star);
    }

    .comment-text {
      color: var(--text-secondary);
      line-height: 1.7;
    }

    /* ============================================
       RATING STARS
       ============================================ */
    .star-rating {
      display: flex;
      gap: 5px;
    }

    .star-rating .star {
      cursor: pointer;
      font-size: 24px;
      color: var(--text-muted);
      transition: color var(--transition);
    }

    .star-rating .star:hover,
    .star-rating .star.active {
      color: var(--star);
    }

    .star-rating .star:hover ~ .star {
      color: var(--text-muted);
    }

    /* ============================================
       SIDEBAR
       ============================================ */
    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 15px;
      letter-spacing: 1px;
    }

    .user-card {
      background: var(--bg-tertiary);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
    }

    .user-card .user-avatar {
      width: 70px;
      height: 70px;
      font-size: 28px;
      margin: 0 auto 15px;
    }

    .user-card h4 {
      margin-bottom: 5px;
    }

    .user-card p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }

    .user-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border);
    }

    .user-stat {
      text-align: center;
    }

    .user-stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .user-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .trending-game {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: background var(--transition);
    }

    .trending-game:hover {
      background: var(--bg-tertiary);
    }

    .trending-rank {
      width: 30px;
      height: 30px;
      background: var(--bg-primary);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: var(--accent);
    }

    .trending-thumb {
      width: 50px;
      height: 50px;
      border-radius: var(--radius-sm);
      background: var(--bg-primary);
      overflow: hidden;
    }

    .trending-info {
      flex: 1;
      min-width: 0;
    }

    .trending-title {
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .trending-plays {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ============================================
       MY GAMES (DEVELOPER PORTAL)
       ============================================ */
    .dev-portal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .games-table {
      width: 100%;
      background: var(--bg-secondary);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .games-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .games-table th,
    .games-table td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .games-table th {
      background: var(--bg-tertiary);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .games-table tr:hover td {
      background: var(--bg-tertiary);
    }

    .table-game {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .table-thumb {
      width: 60px;
      height: 40px;
      border-radius: 6px;
      background: var(--bg-tertiary);
      overflow: hidden;
    }

    .table-actions {
      display: flex;
      gap: 10px;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .analytics-card {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 25px;
      text-align: center;
    }

    .analytics-icon {
      width: 50px;
      height: 50px;
      background: var(--accent-glow);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      color: var(--accent);
      font-size: 24px;
    }

    .analytics-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .analytics-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .analytics-trend {
      font-size: 12px;
      margin-top: 10px;
    }

    .analytics-trend.up {
      color: var(--success);
    }

    .analytics-trend.down {
      color: var(--error);
    }

    /* ============================================
       FOOTER
       ============================================ */
    footer {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      padding: 40px 0;
      margin-top: auto;
    }

    .footer-content {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .footer-links {
      display: flex;
      gap: 25px;
    }

    .footer-links a {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .footer-copyright {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* ============================================
       MODALS
       ============================================ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition);
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      width: 100%;
      max-width: 450px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform var(--transition);
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 25px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-size: 1.25rem;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      transition: all var(--transition);
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 14px;
      transition: border-color var(--transition);
    }

    .form-input:focus {
      border-color: var(--accent);
    }

    .form-error {
      font-size: 12px;
      color: var(--error);
      margin-top: 5px;
    }

    .modal-footer {
      display: flex;
      gap: 15px;
      padding: 0 25px 25px;
    }

    .modal-footer .btn {
      flex: 1;
    }

    /* ============================================
       TOAST NOTIFICATIONS
       ============================================ */
    .toast-container {
      position: fixed;
      top: calc(var(--header-height) + 20px);
      right: 20px;
      z-index: 3000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--accent);
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      border-color: var(--success);
    }

    .toast.error {
      border-color: var(--error);
    }

    .toast.warning {
      border-color: var(--warning);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ============================================
       LOADING STATES
       ============================================ */
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5000;
      flex-direction: column;
      gap: 20px;
    }

    .skeleton {
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }

    /* ============================================
       FAVORITES PAGE
       ============================================ */
    .favorites-empty {
      text-align: center;
      padding: 60px 20px;
      background: var(--bg-secondary);
      border-radius: var(--radius);
    }

    .favorites-empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .favorites-empty h3 {
      margin-bottom: 10px;
    }

    .favorites-empty p {
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    /* ============================================
       RESPONSIVE DESIGN
       ============================================ */
    @media (max-width: 1200px) {
      aside {
        display: none;
      }
    }

    @media (max-width: 900px) {
      .header-content {
        padding: 0 15px;
      }

      nav {
        display: none;
      }

      .hamburger {
        display: flex;
      }

      .search-container {
        max-width: 250px;
      }

      main {
        padding: 20px;
      }

      .hero {
        height: 300px;
      }

      .carousel-content {
        left: 25px;
        bottom: 25px;
      }

      .carousel-title {
        font-size: 1.8rem;
      }

      .game-header {
        flex-direction: column;
      }

      .game-preview {
        width: 100%;
        height: 200px;
      }
    }

    @media (max-width: 600px) {
      :root {
        --header-height: 60px;
      }

      .logo {
        font-size: 1.1rem;
      }

      .search-container {
        display: none;
      }

      .games-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
      }

      .game-thumbnail {
        height: 120px;
      }

      .hero {
        height: 250px;
      }

      .carousel-title {
        font-size: 1.4rem;
      }

      .carousel-desc {
        display: none;
      }

      .player-frame {
        height: 300px;
      }
    }

    /* Mobile Menu */
    .mobile-menu {
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-secondary);
      z-index: 999;
      padding: 20px;
      transform: translateX(-100%);
      transition: transform var(--transition);
    }

    .mobile-menu.active {
      transform: translateX(0);
    }

    .mobile-menu a {
      display: block;
      padding: 15px;
      font-size: 18px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border);
    }

    .mobile-menu a.active {
      color: var(--accent);
    }

    /* High Contrast Mode */
    .high-contrast {
      --bg-primary: #000;
      --bg-secondary: #111;
      --bg-tertiary: #222;
      --text-primary: #fff;
      --text-secondary: #ddd;
      --border: #444;
    }

    /* ============================================
       FILE UPLOAD STYLES
       ============================================ */
    .file-upload-area {
      position: relative;
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 40px 20px;
      text-align: center;
      transition: all var(--transition);
      cursor: pointer;
      background: var(--bg-tertiary);
    }

    .file-upload-area:hover,
    .file-upload-area.dragover {
      border-color: var(--accent);
      background: rgba(0, 191, 255, 0.05);
    }

    .file-upload-area.has-file {
      border-color: var(--success);
      background: rgba(76, 175, 80, 0.05);
    }

    .file-input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .file-upload-icon {
      font-size: 48px;
      display: block;
      margin-bottom: 15px;
    }

    .file-upload-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 5px;
    }

    .file-upload-hint {
      font-size: 13px;
      color: var(--text-muted);
    }

    .file-upload-name {
      margin-top: 15px;
      font-weight: 600;
      color: var(--accent);
      word-break: break-all;
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .control-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .control-key-input {
      width: 120px;
      flex-shrink: 0;
    }

    .control-action-input {
      flex: 1;
    }

    .btn-icon-small {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
      flex-shrink: 0;
    }

    .btn-icon-small:hover {
      background: var(--error);
      color: #fff;
      border-color: var(--error);
    }

    .color-picker-row {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .color-picker {
      width: 60px;
      height: 40px;
      padding: 0;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      background: transparent;
    }

    .color-picker::-webkit-color-swatch-wrapper {
      padding: 2px;
    }

    .color-picker::-webkit-color-swatch {
      border-radius: 4px;
      border: none;
    }

    .color-value {
      font-family: monospace;
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Uploaded game badge */
    .uploaded-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--success);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 4px;
      text-transform: uppercase;
    }

    /* Delete button for uploaded games */
    .delete-game-btn {
      background: var(--error) !important;
      border-color: var(--error) !important;
    }

    .delete-game-btn:hover {
      background: #d32f2f !important;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .control-row {
        flex-wrap: wrap;
      }
      
      .control-key-input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-overlay" id="loadingScreen">
    <div class="spinner"></div>
    <p>Loading Game Hub...</p>
  </div>

  <!-- Header -->
  <header>
    <div class="header-content container">
      <a href="#home" class="logo">HTML5 <span>GAME HUB</span></a>
      
      <nav id="mainNav" role="navigation" aria-label="Main navigation">
        <a href="#home" class="active" data-nav="home">Home</a>
        <a href="#catalog" data-nav="catalog">Catalog</a>
        <a href="#favorites" data-nav="favorites">Favorites</a>
        <a href="#my-games" data-nav="my-games">My Games</a>
      </nav>

      <div class="search-container">
        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" class="search-input" id="searchInput" placeholder="Search games... (Press /)" aria-label="Search games">
      </div>

      <div class="user-actions">
        <button class="btn-icon" id="contrastToggle" aria-label="Toggle high contrast mode" title="Toggle contrast">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        <div class="user-avatar" id="userAvatar" role="button" aria-label="User profile" tabindex="0">
          <span id="userInitials">?</span>
        </div>
      </div>

      <button class="hamburger" id="hamburgerBtn" aria-label="Toggle menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu" role="navigation" aria-label="Mobile navigation">
    <a href="#home" data-nav="home">üè† Home</a>
    <a href="#catalog" data-nav="catalog">üìö Catalog</a>
    <a href="#favorites" data-nav="favorites">‚ù§Ô∏è Favorites</a>
    <a href="#my-games" data-nav="my-games">üéÆ My Games</a>
    <a href="#" id="mobileLoginBtn">üë§ Login / Register</a>
  </div>

  <!-- Main App Container -->
  <div class="app-container">
    <main id="app" role="main">
      <!-- Content loaded dynamically -->
    </main>

    <aside aria-label="Sidebar">
      <!-- User Profile Section -->
      <section class="sidebar-section" id="userSection">
        <h3 class="sidebar-title">Profile</h3>
        <div class="user-card" id="sidebarUserCard">
          <div class="user-avatar">
            <span id="sidebarUserInitials">?</span>
          </div>
          <h4 id="sidebarUsername">Guest User</h4>
          <p id="sidebarUserEmail">Login to save progress</p>
          <button class="btn btn-primary btn-sm" id="sidebarLoginBtn">Login</button>
          <div class="user-stats" id="userStatsSection" style="display: none;">
            <div class="user-stat">
              <div class="user-stat-value" id="statFavorites">0</div>
              <div class="user-stat-label">Favorites</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value" id="statPlays">0</div>
              <div class="user-stat-label">Plays</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value" id="statReviews">0</div>
              <div class="user-stat-label">Reviews</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Trending Games -->
      <section class="sidebar-section">
        <h3 class="sidebar-title">üî• Trending</h3>
        <div id="trendingGames">
          <!-- Populated by JS -->
        </div>
      </section>
    </aside>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-content container">
      <div class="footer-links">
        <a href="#about">About</a>
        <a href="#privacy">Privacy</a>
        <a href="#terms">Terms</a>
        <a href="#contact">Contact</a>
      </div>
      <p class="footer-copyright">¬© 2025 HTML5 Game Hub. All rights reserved.</p>
    </div>
  </footer>

  <!-- Login/Register Modal -->
  <div class="modal-overlay" id="authModal" role="dialog" aria-modal="true" aria-labelledby="authModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h3 id="authModalTitle">Login</h3>
        <button class="modal-close" id="authModalClose" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="authForm">
          <div class="form-group" id="usernameGroup" style="display: none;">
            <label class="form-label" for="authUsername">Username</label>
            <input type="text" class="form-input" id="authUsername" placeholder="Enter username">
            <p class="form-error" id="usernameError"></p>
          </div>
          <div class="form-group">
            <label class="form-label" for="authEmail">Email</label>
            <input type="email" class="form-input" id="authEmail" placeholder="Enter your email" required>
            <p class="form-error" id="emailError"></p>
          </div>
          <div class="form-group">
            <label class="form-label" for="authPassword">Password</label>
            <input type="password" class="form-input" id="authPassword" placeholder="Enter password" required>
            <p class="form-error" id="passwordError"></p>
          </div>
        </form>
        <p style="text-align: center; margin-top: 15px; font-size: 14px; color: var(--text-secondary);">
          <span id="authToggleText">Don't have an account?</span>
          <a href="#" id="authToggle" style="margin-left: 5px;">Register</a>
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="authCancelBtn">Cancel</button>
        <button class="btn btn-primary" id="authSubmitBtn">Login</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer" aria-live="polite"></div>

  <!-- Upload Game Modal -->
  <div class="modal-overlay" id="uploadModal" role="dialog" aria-modal="true" aria-labelledby="uploadModalTitle">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="uploadModalTitle">üì§ Upload Your Game</h3>
        <button class="modal-close" id="uploadModalClose" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="uploadForm">
          <div class="form-group">
            <label class="form-label" for="gameFile">HTML Game File *</label>
            <div class="file-upload-area" id="fileUploadArea">
              <input type="file" class="file-input" id="gameFile" accept=".html,.htm" required>
              <div class="file-upload-content">
                <span class="file-upload-icon">üìÅ</span>
                <p class="file-upload-text">Drag & drop your HTML file here</p>
                <p class="file-upload-hint">or click to browse</p>
                <p class="file-upload-name" id="fileName"></p>
              </div>
            </div>
            <p class="form-hint">Supported: .html, .htm files (max 5MB)</p>
            <p class="form-error" id="fileError"></p>
          </div>
          <div class="form-group">
            <label class="form-label" for="gameTitle">Game Title *</label>
            <input type="text" class="form-input" id="gameTitle" placeholder="Enter game title" required maxlength="50">
            <p class="form-error" id="titleError"></p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="gameGenre">Genre *</label>
              <select class="form-input" id="gameGenre" required>
                <option value="">Select genre</option>
                <option value="Action">Action</option>
                <option value="Puzzle">Puzzle</option>
                <option value="RPG">RPG</option>
                <option value="Racing">Racing</option>
                <option value="Strategy">Strategy</option>
                <option value="Casual">Casual</option>
                <option value="Sports">Sports</option>
                <option value="Adventure">Adventure</option>
                <option value="Simulation">Simulation</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="gamePlayers">Players</label>
              <select class="form-input" id="gamePlayers">
                <option value="1P">Single Player</option>
                <option value="1-2P">1-2 Players</option>
                <option value="1-4P">1-4 Players</option>
                <option value="Multiplayer">Multiplayer</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="gameDescription">Description *</label>
            <textarea class="form-input" id="gameDescription" placeholder="Describe your game..." rows="3" required maxlength="500"></textarea>
            <p class="form-hint"><span id="descCharCount">0</span>/500 characters</p>
          </div>
          <div class="form-group">
            <label class="form-label">Controls (optional)</label>
            <div id="controlsContainer">
              <div class="control-row">
                <input type="text" class="form-input control-key-input" placeholder="Key (e.g. WASD)">
                <input type="text" class="form-input control-action-input" placeholder="Action (e.g. Move)">
                <button type="button" class="btn-icon-small" onclick="removeControlRow(this)">‚úï</button>
              </div>
            </div>
            <button type="button" class="btn btn-sm btn-secondary" onclick="addControlRow()" style="margin-top: 10px;">+ Add Control</button>
          </div>
          <div class="form-group">
            <label class="form-label" for="gameThumbnailColor">Thumbnail Color</label>
            <div class="color-picker-row">
              <input type="color" class="color-picker" id="gameThumbnailColor" value="#1a237e">
              <span class="color-value" id="colorValue">#1a237e</span>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="uploadCancelBtn">Cancel</button>
        <button class="btn btn-primary" id="uploadSubmitBtn">üöÄ Upload Game</button>
      </div>
    </div>
  </div>

  <script>
    /**
     * ============================================
     * HTML5 GAME HUB - Complete Game Portal
     * ============================================
     * 
     * ARCHITECTURE:
     * - Router: Hash-based navigation system
     * - Store: Central state management
     * - Components: Modular UI rendering
     * - Services: User auth, game management
     * 
     * HOW TO ADD A NEW GAME:
     * 1. Add game object to GAMES array below
     * 2. Required fields: id, title, genre, developer, description
     * 3. Optional: thumbnail (base64 or URL), url (game file path)
     * 4. Games without url will show demo canvas
     * 
     * GAME API CONTRACT:
     * Games embedded via iframe should expose:
     * window.gameAPI = {
     *   pause: () => {},      // Pause game logic
     *   resume: () => {},     // Resume game logic
     *   getScore: () => 0,    // Return current score
     *   onGameOver: (cb) => {} // Game over callback
     * }
     * 
     * USER DATA SCHEMA (localStorage):
     * - gh_users: Array of user objects {id, username, email, password, createdAt}
     * - gh_currentUser: Current logged-in user ID
     * - gh_favorites: Object {userId: [gameIds]}
     * - gh_ratings: Object {gameId: {userId: rating}}
     * - gh_comments: Object {gameId: [{userId, text, rating, date}]}
     * - gh_gamePlays: Object {gameId: playCount}
     * - game_{id}_save: Individual game save data
     */

    // ============================================
    // GAME CATALOG DATA
    // ============================================
    const GAMES = [
      {
        id: "space-shooter",
        title: "Space Shooter",
        genre: "Action",
        developer: "CosmicGames",
        description: "Defend Earth from alien invaders in this classic arcade shooter! Collect power-ups, dodge asteroids, and defeat massive boss enemies across 20 thrilling levels.",
        thumbnail: null,
        thumbnailColor: "#1a237e",
        url: null,
        controls: [
          { key: "‚Üê ‚Üí", action: "Move ship" },
          { key: "Space", action: "Fire" },
          { key: "Shift", action: "Special weapon" },
          { key: "P", action: "Pause" }
        ],
        players: "1P",
        releaseDate: "2025-01-15"
      },
      {
        id: "puzzle-master",
        title: "Puzzle Master",
        genre: "Puzzle",
        developer: "BrainTeaser Inc",
        description: "Challenge your mind with 100+ unique puzzles! Match colors, solve patterns, and unlock new worlds in this addictive brain trainer.",
        thumbnail: null,
        thumbnailColor: "#4a148c",
        url: null,
        controls: [
          { key: "Mouse", action: "Select pieces" },
          { key: "R", action: "Rotate" },
          { key: "H", action: "Hint" },
          { key: "Esc", action: "Menu" }
        ],
        players: "1P",
        releaseDate: "2025-02-20"
      },
      {
        id: "racing-fury",
        title: "Racing Fury",
        genre: "Racing",
        developer: "SpeedDemon Studios",
        description: "Feel the adrenaline rush as you race through stunning tracks! Customize your car, compete online, and become the ultimate racing champion.",
        thumbnail: null,
        thumbnailColor: "#b71c1c",
        url: null,
        controls: [
          { key: "‚Üë ‚Üì", action: "Accelerate/Brake" },
          { key: "‚Üê ‚Üí", action: "Steer" },
          { key: "N", action: "Nitro boost" },
          { key: "C", action: "Change view" }
        ],
        players: "1-4P",
        releaseDate: "2025-03-10"
      },
      {
        id: "dungeon-crawler",
        title: "Dungeon Crawler",
        genre: "RPG",
        developer: "PixelQuest",
        description: "Explore dark dungeons, defeat monsters, and collect epic loot! Level up your hero, learn powerful skills, and face the dragon king.",
        thumbnail: null,
        thumbnailColor: "#1b5e20",
        url: null,
        controls: [
          { key: "WASD", action: "Move" },
          { key: "Mouse", action: "Attack/Aim" },
          { key: "1-5", action: "Skills" },
          { key: "I", action: "Inventory" }
        ],
        players: "1P",
        releaseDate: "2025-01-05"
      },
      {
        id: "block-builder",
        title: "Block Builder",
        genre: "Casual",
        developer: "CreativeMinds",
        description: "Build amazing structures block by block! Let your imagination run wild in this relaxing sandbox game with unlimited possibilities.",
        thumbnail: null,
        thumbnailColor: "#f57f17",
        url: null,
        controls: [
          { key: "Mouse", action: "Place/Remove blocks" },
          { key: "Scroll", action: "Change block" },
          { key: "WASD", action: "Move camera" },
          { key: "Tab", action: "Block menu" }
        ],
        players: "1-2P",
        releaseDate: "2025-04-01"
      },
      {
        id: "zombie-survival",
        title: "Zombie Survival",
        genre: "Action",
        developer: "UndeadGames",
        description: "Survive the zombie apocalypse! Scavenge for supplies, build defenses, and fight off endless waves of the undead in this intense survival game.",
        thumbnail: null,
        thumbnailColor: "#263238",
        url: null,
        controls: [
          { key: "WASD", action: "Move" },
          { key: "Mouse", action: "Aim/Shoot" },
          { key: "R", action: "Reload" },
          { key: "E", action: "Interact" }
        ],
        players: "1-4P",
        releaseDate: "2025-02-14"
      },
      {
        id: "candy-crush",
        title: "Candy Match",
        genre: "Puzzle",
        developer: "SweetGames",
        description: "Match colorful candies in this sweet puzzle adventure! Complete 500 levels, unlock special candies, and compete with friends.",
        thumbnail: null,
        thumbnailColor: "#e91e63",
        url: null,
        controls: [
          { key: "Mouse/Touch", action: "Swap candies" },
          { key: "H", action: "Use hint" }
        ],
        players: "1P",
        releaseDate: "2025-03-25"
      },
      {
        id: "tower-defense",
        title: "Tower Defense Pro",
        genre: "Strategy",
        developer: "TacticalMinds",
        description: "Build towers, upgrade defenses, and stop the enemy invasion! Strategic placement and timing are key to victory in 50 challenging maps.",
        thumbnail: null,
        thumbnailColor: "#00695c",
        url: null,
        controls: [
          { key: "Mouse", action: "Build/Select towers" },
          { key: "1-6", action: "Quick build" },
          { key: "U", action: "Upgrade" },
          { key: "Space", action: "Start wave" }
        ],
        players: "1P",
        releaseDate: "2025-01-30"
      },
      {
        id: "ninja-runner",
        title: "Ninja Runner",
        genre: "Action",
        developer: "ShadowSoft",
        description: "Run, jump, and slash through enemies as a swift ninja! Master wall-running, double jumps, and deadly combos in this fast-paced platformer.",
        thumbnail: null,
        thumbnailColor: "#311b92",
        url: null,
        controls: [
          { key: "‚Üí", action: "Auto-run" },
          { key: "Space/‚Üë", action: "Jump" },
          { key: "‚Üì", action: "Slide" },
          { key: "X", action: "Attack" }
        ],
        players: "1P",
        releaseDate: "2025-04-15"
      },
      {
        id: "word-wizard",
        title: "Word Wizard",
        genre: "Puzzle",
        developer: "LexiconLabs",
        description: "Expand your vocabulary and become a word wizard! Solve crosswords, anagrams, and word searches across multiple difficulty levels.",
        thumbnail: null,
        thumbnailColor: "#0277bd",
        url: null,
        controls: [
          { key: "Keyboard", action: "Type letters" },
          { key: "Enter", action: "Submit word" },
          { key: "Backspace", action: "Delete" }
        ],
        players: "1P",
        releaseDate: "2025-02-28"
      },
      {
        id: "farm-life",
        title: "Farm Life",
        genre: "Casual",
        developer: "HarvestMoon Studios",
        description: "Build your dream farm! Plant crops, raise animals, and create a thriving agricultural empire in this relaxing simulation game.",
        thumbnail: null,
        thumbnailColor: "#33691e",
        url: null,
        controls: [
          { key: "Mouse", action: "Interact" },
          { key: "WASD", action: "Move" },
          { key: "E", action: "Use tool" },
          { key: "B", action: "Build menu" }
        ],
        players: "1P",
        releaseDate: "2025-03-05"
      },
      {
        id: "chess-master",
        title: "Chess Master",
        genre: "Strategy",
        developer: "GrandMaster Games",
        description: "Test your strategic mind against AI opponents or other players! Multiple difficulty levels and tutorials for beginners to grandmasters.",
        thumbnail: null,
        thumbnailColor: "#3e2723",
        url: null,
        controls: [
          { key: "Mouse", action: "Select/Move pieces" },
          { key: "Ctrl+Z", action: "Undo move" },
          { key: "H", action: "Hint" }
        ],
        players: "1-2P",
        releaseDate: "2025-01-20"
      },
      {
        id: "bubble-pop",
        title: "Bubble Pop Mania",
        genre: "Casual",
        developer: "PopGames",
        description: "Pop colorful bubbles in this addictive casual game! Aim carefully, create combos, and clear all bubbles to complete each level.",
        thumbnail: null,
        thumbnailColor: "#00bcd4",
        url: null,
        controls: [
          { key: "Mouse", action: "Aim & Shoot" },
          { key: "Space", action: "Swap bubbles" }
        ],
        players: "1P",
        releaseDate: "2025-04-10"
      },
      {
        id: "soccer-stars",
        title: "Soccer Stars",
        genre: "Sports",
        developer: "GoalMasters",
        description: "Experience the thrill of soccer! Play quick matches, manage your team, and compete in tournaments against players worldwide.",
        thumbnail: null,
        thumbnailColor: "#2e7d32",
        url: null,
        controls: [
          { key: "Mouse/Touch", action: "Aim & Shoot" },
          { key: "Drag", action: "Set power" }
        ],
        players: "1-2P",
        releaseDate: "2025-02-10"
      },
      {
        id: "memory-match",
        title: "Memory Match",
        genre: "Puzzle",
        developer: "MindGames",
        description: "Test and improve your memory! Flip cards, find matching pairs, and challenge yourself with increasingly difficult levels.",
        thumbnail: null,
        thumbnailColor: "#7b1fa2",
        url: null,
        controls: [
          { key: "Mouse/Touch", action: "Flip cards" }
        ],
        players: "1P",
        releaseDate: "2025-03-15"
      },
      {
        id: "platform-adventure",
        title: "Platform Adventure",
        genre: "Action",
        developer: "JumpMasters",
        description: "Embark on an epic platforming journey! Discover hidden secrets, collect gems, and defeat bosses across 60 beautifully crafted levels.",
        thumbnail: null,
        thumbnailColor: "#ff5722",
        url: null,
        controls: [
          { key: "‚Üê ‚Üí", action: "Move" },
          { key: "Space", action: "Jump" },
          { key: "Z", action: "Attack" },
          { key: "X", action: "Special" }
        ],
        players: "1P",
        releaseDate: "2025-01-25"
      }
    ];

    // ============================================
    // CENTRAL STORE (State Management)
    // ============================================
    const Store = {
      state: {
        currentUser: null,
        games: [...GAMES],
        uploadedGames: [],
        gamePlays: {},
        ratings: {},
        comments: {},
        favorites: {},
        filters: {
          genre: 'all',
          players: 'all',
          sort: 'popular'
        },
        searchQuery: '',
        currentPage: 1,
        gamesPerPage: 12
      },

      init() {
        // Load data from localStorage
        this.state.gamePlays = this.load('gh_gamePlays') || {};
        this.state.ratings = this.load('gh_ratings') || {};
        this.state.comments = this.load('gh_comments') || {};
        this.state.favorites = this.load('gh_favorites') || {};
        
        // Load uploaded games
        this.state.uploadedGames = this.load('gh_uploadedGames') || [];
        
        // Merge uploaded games into games array
        this.state.uploadedGames.forEach(game => {
          if (!this.state.games.find(g => g.id === game.id)) {
            this.state.games.push(game);
          }
        });
        
        // Initialize play counts
        this.state.games.forEach(game => {
          if (!this.state.gamePlays[game.id]) {
            this.state.gamePlays[game.id] = Math.floor(Math.random() * 50000) + 1000;
          }
        });

        // Initialize ratings
        this.state.games.forEach(game => {
          if (!this.state.ratings[game.id]) {
            this.state.ratings[game.id] = {};
            // Add some initial ratings
            const numRatings = Math.floor(Math.random() * 50) + 10;
            for (let i = 0; i < numRatings; i++) {
              this.state.ratings[game.id][`user_${i}`] = Math.floor(Math.random() * 3) + 3;
            }
          }
        });

        this.save('gh_gamePlays', this.state.gamePlays);
        this.save('gh_ratings', this.state.ratings);

        // Check for logged-in user
        const userId = this.load('gh_currentUser');
        if (userId) {
          const users = this.load('gh_users') || [];
          this.state.currentUser = users.find(u => u.id === userId);
        }
      },

      save(key, data) {
        try {
          localStorage.setItem(key, JSON.stringify(data));
        } catch (e) {
          console.warn('localStorage save failed:', e);
        }
      },

      load(key) {
        try {
          const data = localStorage.getItem(key);
          return data ? JSON.parse(data) : null;
        } catch (e) {
          console.warn('localStorage load failed:', e);
          return null;
        }
      },

      getGameById(id) {
        return this.state.games.find(g => g.id === id);
      },

      getGameRating(gameId) {
        const ratings = this.state.ratings[gameId] || {};
        const values = Object.values(ratings);
        if (values.length === 0) return 0;
        return (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1);
      },

      getGamePlays(gameId) {
        return this.state.gamePlays[gameId] || 0;
      },

      incrementPlays(gameId) {
        this.state.gamePlays[gameId] = (this.state.gamePlays[gameId] || 0) + 1;
        this.save('gh_gamePlays', this.state.gamePlays);
      },

      rateGame(gameId, rating) {
        if (!this.state.currentUser) return false;
        if (!this.state.ratings[gameId]) {
          this.state.ratings[gameId] = {};
        }
        this.state.ratings[gameId][this.state.currentUser.id] = rating;
        this.save('gh_ratings', this.state.ratings);
        return true;
      },

      getUserRating(gameId) {
        if (!this.state.currentUser) return 0;
        return this.state.ratings[gameId]?.[this.state.currentUser.id] || 0;
      },

      addComment(gameId, text, rating) {
        if (!this.state.currentUser) return false;
        if (!this.state.comments[gameId]) {
          this.state.comments[gameId] = [];
        }
        this.state.comments[gameId].unshift({
          userId: this.state.currentUser.id,
          username: this.state.currentUser.username,
          text: this.sanitize(text),
          rating,
          date: new Date().toISOString()
        });
        this.save('gh_comments', this.state.comments);
        return true;
      },

      getComments(gameId) {
        return this.state.comments[gameId] || [];
      },

      toggleFavorite(gameId) {
        const userId = this.state.currentUser?.id || 'guest';
        if (!this.state.favorites[userId]) {
          this.state.favorites[userId] = [];
        }
        const index = this.state.favorites[userId].indexOf(gameId);
        if (index > -1) {
          this.state.favorites[userId].splice(index, 1);
        } else {
          this.state.favorites[userId].push(gameId);
        }
        this.save('gh_favorites', this.state.favorites);
        return this.isFavorite(gameId);
      },

      isFavorite(gameId) {
        const userId = this.state.currentUser?.id || 'guest';
        return this.state.favorites[userId]?.includes(gameId) || false;
      },

      getFavorites() {
        const userId = this.state.currentUser?.id || 'guest';
        return this.state.favorites[userId] || [];
      },

      getFilteredGames() {
        let games = [...this.state.games];

        // Search filter
        if (this.state.searchQuery) {
          const query = this.state.searchQuery.toLowerCase();
          games = games.filter(g => 
            g.title.toLowerCase().includes(query) ||
            g.genre.toLowerCase().includes(query) ||
            g.developer.toLowerCase().includes(query)
          );
        }

        // Genre filter
        if (this.state.filters.genre !== 'all') {
          games = games.filter(g => g.genre === this.state.filters.genre);
        }

        // Players filter
        if (this.state.filters.players !== 'all') {
          games = games.filter(g => g.players.includes(this.state.filters.players));
        }

        // Sorting
        switch (this.state.filters.sort) {
          case 'popular':
            games.sort((a, b) => this.getGamePlays(b.id) - this.getGamePlays(a.id));
            break;
          case 'rating':
            games.sort((a, b) => this.getGameRating(b.id) - this.getGameRating(a.id));
            break;
          case 'newest':
            games.sort((a, b) => new Date(b.releaseDate) - new Date(a.releaseDate));
            break;
          case 'oldest':
            games.sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate));
            break;
          case 'alphabetical':
            games.sort((a, b) => a.title.localeCompare(b.title));
            break;
        }

        return games;
      },

      sanitize(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      },

      // Upload game functionality
      uploadGame(gameData) {
        const userId = this.state.currentUser?.id || 'guest';
        const gameId = 'uploaded_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        const game = {
          id: gameId,
          title: this.sanitize(gameData.title),
          genre: gameData.genre,
          developer: this.state.currentUser?.username || 'Guest Developer',
          developerId: userId,
          description: this.sanitize(gameData.description),
          thumbnail: null,
          thumbnailColor: gameData.thumbnailColor || '#1a237e',
          htmlContent: gameData.htmlContent,
          controls: gameData.controls || [],
          players: gameData.players || '1P',
          releaseDate: new Date().toISOString().split('T')[0],
          isUploaded: true,
          uploadedAt: new Date().toISOString()
        };

        // Add to games array
        this.state.games.unshift(game);
        this.state.uploadedGames.unshift(game);
        
        // Initialize plays and ratings
        this.state.gamePlays[gameId] = 0;
        this.state.ratings[gameId] = {};

        // Save to localStorage
        this.save('gh_uploadedGames', this.state.uploadedGames);
        this.save('gh_gamePlays', this.state.gamePlays);
        this.save('gh_ratings', this.state.ratings);

        return game;
      },

      deleteGame(gameId) {
        const game = this.getGameById(gameId);
        if (!game || !game.isUploaded) return false;

        // Check ownership
        const userId = this.state.currentUser?.id || 'guest';
        if (game.developerId !== userId) return false;

        // Remove from arrays
        this.state.games = this.state.games.filter(g => g.id !== gameId);
        this.state.uploadedGames = this.state.uploadedGames.filter(g => g.id !== gameId);

        // Clean up related data
        delete this.state.gamePlays[gameId];
        delete this.state.ratings[gameId];
        delete this.state.comments[gameId];

        // Remove from favorites
        Object.keys(this.state.favorites).forEach(userId => {
          this.state.favorites[userId] = this.state.favorites[userId].filter(id => id !== gameId);
        });

        // Save all changes
        this.save('gh_uploadedGames', this.state.uploadedGames);
        this.save('gh_gamePlays', this.state.gamePlays);
        this.save('gh_ratings', this.state.ratings);
        this.save('gh_comments', this.state.comments);
        this.save('gh_favorites', this.state.favorites);

        return true;
      },

      getUserUploadedGames() {
        const userId = this.state.currentUser?.id || 'guest';
        return this.state.uploadedGames.filter(g => g.developerId === userId);
      },

      getGameHtmlContent(gameId) {
        const game = this.getGameById(gameId);
        return game?.htmlContent || null;
      }
    };

    // ============================================
    // USER SERVICE (Authentication)
    // ============================================
    const UserService = {
      register(username, email, password) {
        const users = Store.load('gh_users') || [];
        
        if (users.find(u => u.email === email)) {
          return { success: false, error: 'Email already registered' };
        }

        const user = {
          id: 'user_' + Date.now(),
          username: Store.sanitize(username),
          email: email.toLowerCase(),
          password: this.hashPassword(password),
          createdAt: new Date().toISOString(),
          isDev: false
        };

        users.push(user);
        Store.save('gh_users', users);
        
        return { success: true, user };
      },

      login(email, password) {
        const users = Store.load('gh_users') || [];
        const user = users.find(u => u.email === email.toLowerCase());
        
        if (!user) {
          return { success: false, error: 'User not found' };
        }

        if (user.password !== this.hashPassword(password)) {
          return { success: false, error: 'Invalid password' };
        }

        Store.state.currentUser = user;
        Store.save('gh_currentUser', user.id);
        
        return { success: true, user };
      },

      logout() {
        Store.state.currentUser = null;
        localStorage.removeItem('gh_currentUser');
      },

      hashPassword(password) {
        // Simple hash for demo (use proper hashing in production)
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return hash.toString(16);
      },

      getUserStats() {
        if (!Store.state.currentUser) return { favorites: 0, plays: 0, reviews: 0 };
        const userId = Store.state.currentUser.id;
        const favorites = Store.state.favorites[userId]?.length || 0;
        let reviews = 0;
        Object.values(Store.state.comments).forEach(comments => {
          reviews += comments.filter(c => c.userId === userId).length;
        });
        return { favorites, plays: favorites * 3, reviews };
      }
    };

    // ============================================
    // ROUTER (Hash-based Navigation)
    // ============================================
    const Router = {
      routes: {},

      init() {
        window.addEventListener('hashchange', () => this.handleRoute());
        window.addEventListener('load', () => this.handleRoute());
      },

      register(route, handler) {
        this.routes[route] = handler;
      },

      handleRoute() {
        const hash = window.location.hash || '#home';
        const [route, param] = hash.slice(1).split('=');
        
        // Update navigation
        document.querySelectorAll('[data-nav]').forEach(el => {
          el.classList.toggle('active', el.dataset.nav === route);
        });

        // Close mobile menu
        document.getElementById('mobileMenu').classList.remove('active');

        // Call route handler
        if (this.routes[route]) {
          this.routes[route](param);
        } else {
          this.routes['home']();
        }

        // Scroll to top
        window.scrollTo(0, 0);
      },

      navigate(route) {
        window.location.hash = route;
      }
    };

    // ============================================
    // UI COMPONENTS
    // ============================================
    const UI = {
      app: document.getElementById('app'),

      // Render game thumbnail using canvas
      renderThumbnail(game, canvas) {
        const ctx = canvas.getContext('2d');
        const w = canvas.width;
        const h = canvas.height;

        // Background gradient
        const gradient = ctx.createLinearGradient(0, 0, w, h);
        gradient.addColorStop(0, game.thumbnailColor || '#1a237e');
        gradient.addColorStop(1, '#000');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, w, h);

        // Decorative elements based on genre
        ctx.globalAlpha = 0.3;
        switch(game.genre) {
          case 'Action':
            // Lightning bolts
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(w * 0.3, 0);
            ctx.lineTo(w * 0.5, h * 0.4);
            ctx.lineTo(w * 0.4, h * 0.4);
            ctx.lineTo(w * 0.6, h);
            ctx.stroke();
            break;
          case 'Puzzle':
            // Puzzle pieces
            for (let i = 0; i < 4; i++) {
              ctx.fillStyle = `hsl(${i * 90}, 70%, 60%)`;
              ctx.fillRect(w * 0.2 + (i % 2) * w * 0.3, h * 0.2 + Math.floor(i / 2) * h * 0.3, w * 0.25, h * 0.25);
            }
            break;
          case 'Racing':
            // Speed lines
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            for (let i = 0; i < 10; i++) {
              ctx.beginPath();
              ctx.moveTo(0, h * 0.1 * i);
              ctx.lineTo(w * 0.7, h * 0.1 * i + 20);
              ctx.stroke();
            }
            break;
          case 'RPG':
            // Sword
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.moveTo(w * 0.5, h * 0.1);
            ctx.lineTo(w * 0.55, h * 0.7);
            ctx.lineTo(w * 0.5, h * 0.75);
            ctx.lineTo(w * 0.45, h * 0.7);
            ctx.closePath();
            ctx.fill();
            break;
          default:
            // Stars
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 20; i++) {
              const x = Math.random() * w;
              const y = Math.random() * h;
              ctx.beginPath();
              ctx.arc(x, y, 2, 0, Math.PI * 2);
              ctx.fill();
            }
        }

        ctx.globalAlpha = 1;

        // Game icon
        ctx.font = 'bold 48px Arial';
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(game.title.charAt(0), w / 2, h / 2);
      },

      // Create game card element
      createGameCard(game) {
        const isFav = Store.isFavorite(game.id);
        const rating = Store.getGameRating(game.id);
        const plays = Store.getGamePlays(game.id);

        const card = document.createElement('article');
        card.className = 'game-card';
        card.setAttribute('role', 'article');
        card.setAttribute('aria-label', `${game.title} - ${game.genre} game`);
        card.innerHTML = `
          <div class="game-thumbnail">
            <canvas width="300" height="180" aria-hidden="true"></canvas>
            ${game.isUploaded ? '<span class="uploaded-badge">User Game</span>' : ''}
            <div class="game-overlay">
              <button class="play-btn-large" aria-label="Play ${game.title}">‚ñ∂</button>
            </div>
          </div>
          <div class="game-info">
            <span class="game-genre">${game.genre}</span>
            <h3 class="game-title">${game.title}</h3>
            <div class="game-meta">
              <span class="game-rating" aria-label="Rating: ${rating} out of 5 stars">
                <span aria-hidden="true">‚òÖ</span> ${rating}
              </span>
              <span class="game-plays" aria-label="${this.formatNumber(plays)} plays">
                <span aria-hidden="true">üëÅ</span> ${this.formatNumber(plays)}
              </span>
            </div>
          </div>
          <div class="game-actions">
            <button class="btn btn-primary btn-sm" onclick="Router.navigate('game=${game.id}')">Play Now</button>
            <button class="favorite-btn ${isFav ? 'active' : ''}" 
                    onclick="event.stopPropagation(); UI.toggleFavorite('${game.id}', this)"
                    aria-label="${isFav ? 'Remove from' : 'Add to'} favorites"
                    aria-pressed="${isFav}">
              ${isFav ? '‚ù§Ô∏è' : 'ü§ç'}
            </button>
          </div>
        `;

        // Render thumbnail
        const canvas = card.querySelector('canvas');
        this.renderThumbnail(game, canvas);

        // Click to open game detail
        card.querySelector('.game-thumbnail').addEventListener('click', () => {
          Router.navigate(`game=${game.id}`);
        });

        return card;
      },

      toggleFavorite(gameId, btn) {
        const isFav = Store.toggleFavorite(gameId);
        btn.innerHTML = isFav ? '‚ù§Ô∏è' : 'ü§ç';
        btn.classList.toggle('active', isFav);
        btn.setAttribute('aria-pressed', isFav);
        btn.setAttribute('aria-label', `${isFav ? 'Remove from' : 'Add to'} favorites`);
        this.showToast(isFav ? 'Added to favorites!' : 'Removed from favorites', isFav ? 'success' : '');
        this.updateSidebar();
      },

      formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toString();
      },

      showToast(message, type = '') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
          <span>${message}</span>
          <button onclick="this.parentElement.remove()" aria-label="Close notification">‚úï</button>
        `;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      },

      updateSidebar() {
        const user = Store.state.currentUser;
        const stats = UserService.getUserStats();

        document.getElementById('sidebarUsername').textContent = user?.username || 'Guest User';
        document.getElementById('sidebarUserEmail').textContent = user?.email || 'Login to save progress';
        document.getElementById('sidebarUserInitials').textContent = user?.username?.charAt(0).toUpperCase() || '?';
        document.getElementById('userInitials').textContent = user?.username?.charAt(0).toUpperCase() || '?';

        const loginBtn = document.getElementById('sidebarLoginBtn');
        const statsSection = document.getElementById('userStatsSection');

        if (user) {
          loginBtn.textContent = 'Logout';
          loginBtn.onclick = () => {
            UserService.logout();
            this.updateSidebar();
            this.showToast('Logged out successfully');
            Router.handleRoute();
          };
          statsSection.style.display = 'flex';
          document.getElementById('statFavorites').textContent = stats.favorites;
          document.getElementById('statPlays').textContent = stats.plays;
          document.getElementById('statReviews').textContent = stats.reviews;
        } else {
          loginBtn.textContent = 'Login';
          loginBtn.onclick = () => openAuthModal();
          statsSection.style.display = 'none';
        }

        // Update trending games
        this.renderTrending();
      },

      renderTrending() {
        const trending = [...Store.state.games]
          .sort((a, b) => Store.getGamePlays(b.id) - Store.getGamePlays(a.id))
          .slice(0, 5);

        const container = document.getElementById('trendingGames');
        container.innerHTML = trending.map((game, i) => `
          <div class="trending-game" onclick="Router.navigate('game=${game.id}')" tabindex="0" role="link">
            <div class="trending-rank">${i + 1}</div>
            <div class="trending-thumb">
              <canvas width="50" height="50" data-game-id="${game.id}"></canvas>
            </div>
            <div class="trending-info">
              <div class="trending-title">${game.title}</div>
              <div class="trending-plays">${this.formatNumber(Store.getGamePlays(game.id))} plays</div>
            </div>
          </div>
        `).join('');

        // Render mini thumbnails
        container.querySelectorAll('canvas').forEach(canvas => {
          const game = Store.getGameById(canvas.dataset.gameId);
          if (game) this.renderThumbnail(game, canvas);
        });
      }
    };

    // ============================================
    // PAGE RENDERERS
    // ============================================

    // HOME PAGE
    function renderHome() {
      const featuredGames = Store.state.games.slice(0, 5);
      const popularGames = [...Store.state.games]
        .sort((a, b) => Store.getGamePlays(b.id) - Store.getGamePlays(a.id))
        .slice(0, 12);

      UI.app.innerHTML = `
        <!-- Hero Carousel -->
        <section class="hero" aria-label="Featured games carousel">
          <div class="carousel" id="carousel">
            ${featuredGames.map((game, i) => `
              <div class="carousel-slide ${i === 0 ? 'active' : ''}" style="background-color: ${game.thumbnailColor}" data-index="${i}">
                <div class="carousel-content">
                  <span class="carousel-badge">Featured</span>
                  <h2 class="carousel-title">${game.title}</h2>
                  <p class="carousel-desc">${game.description.slice(0, 100)}...</p>
                  <button class="btn btn-primary" onclick="Router.navigate('game=${game.id}')">
                    ‚ñ∂ Play Now
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
          <div class="carousel-arrows">
            <button class="carousel-arrow" onclick="carouselPrev()" aria-label="Previous game">‚Äπ</button>
            <button class="carousel-arrow" onclick="carouselNext()" aria-label="Next game">‚Ä∫</button>
          </div>
          <div class="carousel-nav" role="tablist" aria-label="Carousel navigation">
            ${featuredGames.map((_, i) => `
              <button class="carousel-dot ${i === 0 ? 'active' : ''}" 
                      onclick="goToSlide(${i})" 
                      role="tab"
                      aria-selected="${i === 0}"
                      aria-label="Go to slide ${i + 1}"></button>
            `).join('')}
          </div>
        </section>

        <!-- Popular Games -->
        <section aria-labelledby="popular-title">
          <div class="section-header">
            <h2 class="section-title" id="popular-title">Popular Games</h2>
            <a href="#catalog" class="view-all">View All ‚Üí</a>
          </div>
          <div class="games-grid" id="popularGames"></div>
        </section>
      `;

      // Render game cards
      const grid = document.getElementById('popularGames');
      popularGames.forEach(game => {
        grid.appendChild(UI.createGameCard(game));
      });

      // Initialize carousel auto-play
      startCarousel();
    }

    let carouselInterval;
    let currentSlide = 0;

    function startCarousel() {
      carouselInterval = setInterval(carouselNext, 5000);
    }

    function goToSlide(index) {
      const slides = document.querySelectorAll('.carousel-slide');
      const dots = document.querySelectorAll('.carousel-dot');
      
      slides.forEach(s => s.classList.remove('active'));
      dots.forEach(d => {
        d.classList.remove('active');
        d.setAttribute('aria-selected', 'false');
      });
      
      slides[index]?.classList.add('active');
      dots[index]?.classList.add('active');
      dots[index]?.setAttribute('aria-selected', 'true');
      
      currentSlide = index;
    }

    function carouselNext() {
      const slides = document.querySelectorAll('.carousel-slide');
      currentSlide = (currentSlide + 1) % slides.length;
      goToSlide(currentSlide);
    }

    function carouselPrev() {
      const slides = document.querySelectorAll('.carousel-slide');
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      goToSlide(currentSlide);
    }

    // CATALOG PAGE
    function renderCatalog() {
      const genres = [...new Set(Store.state.games.map(g => g.genre))];
      
      UI.app.innerHTML = `
        <h1 class="section-title" style="margin-bottom: 25px;">Game Catalog</h1>
        
        <!-- Filters -->
        <div class="catalog-controls" role="search">
          <div class="filter-group">
            <label class="filter-label" for="sortFilter">Sort By</label>
            <select class="filter-select" id="sortFilter" onchange="applyFilters()">
              <option value="popular">Most Popular</option>
              <option value="rating">Highest Rated</option>
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="alphabetical">A-Z</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label" for="playersFilter">Players</label>
            <select class="filter-select" id="playersFilter" onchange="applyFilters()">
              <option value="all">All</option>
              <option value="1P">Single Player</option>
              <option value="2P">2 Players</option>
              <option value="4P">Multiplayer</option>
            </select>
          </div>
          <div class="filter-group" style="flex: 1;">
            <label class="filter-label">Genre</label>
            <div class="genre-chips" role="radiogroup" aria-label="Filter by genre">
              <button class="genre-chip active" data-genre="all" onclick="filterGenre('all', this)">All</button>
              ${genres.map(g => `
                <button class="genre-chip" data-genre="${g}" onclick="filterGenre('${g}', this)">${g}</button>
              `).join('')}
            </div>
          </div>
        </div>

        <!-- Games Grid -->
        <div class="games-grid" id="catalogGrid"></div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" role="navigation" aria-label="Pagination"></div>
      `;

      renderCatalogGames();
    }

    function filterGenre(genre, btn) {
      document.querySelectorAll('.genre-chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      Store.state.filters.genre = genre;
      Store.state.currentPage = 1;
      renderCatalogGames();
    }

    function applyFilters() {
      Store.state.filters.sort = document.getElementById('sortFilter').value;
      Store.state.filters.players = document.getElementById('playersFilter').value;
      Store.state.currentPage = 1;
      renderCatalogGames();
    }

    function renderCatalogGames() {
      const games = Store.getFilteredGames();
      const { currentPage, gamesPerPage } = Store.state;
      const totalPages = Math.ceil(games.length / gamesPerPage);
      const start = (currentPage - 1) * gamesPerPage;
      const pageGames = games.slice(start, start + gamesPerPage);

      const grid = document.getElementById('catalogGrid');
      grid.innerHTML = '';
      pageGames.forEach(game => {
        grid.appendChild(UI.createGameCard(game));
      });

      // Pagination
      const pagination = document.getElementById('pagination');
      if (totalPages > 1) {
        pagination.innerHTML = `
          <button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} aria-label="Previous page">‚Äπ</button>
          ${Array.from({ length: Math.min(totalPages, 7) }, (_, i) => {
            let pageNum;
            if (totalPages <= 7) {
              pageNum = i + 1;
            } else if (currentPage <= 4) {
              pageNum = i + 1;
            } else if (currentPage >= totalPages - 3) {
              pageNum = totalPages - 6 + i;
            } else {
              pageNum = currentPage - 3 + i;
            }
            return `<button class="page-btn ${pageNum === currentPage ? 'active' : ''}" 
                            onclick="goToPage(${pageNum})"
                            ${pageNum === currentPage ? 'aria-current="page"' : ''}>${pageNum}</button>`;
          }).join('')}
          <button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} aria-label="Next page">‚Ä∫</button>
        `;
      } else {
        pagination.innerHTML = '';
      }
    }

    function goToPage(page) {
      const games = Store.getFilteredGames();
      const totalPages = Math.ceil(games.length / Store.state.gamesPerPage);
      if (page >= 1 && page <= totalPages) {
        Store.state.currentPage = page;
        renderCatalogGames();
        document.getElementById('catalogGrid').scrollIntoView({ behavior: 'smooth' });
      }
    }

    // GAME DETAIL PAGE
    function renderGameDetail(gameId) {
      const game = Store.getGameById(gameId);
      if (!game) {
        UI.app.innerHTML = '<p>Game not found</p>';
        return;
      }

      const rating = Store.getGameRating(game.id);
      const plays = Store.getGamePlays(game.id);
      const userRating = Store.getUserRating(game.id);
      const isFav = Store.isFavorite(game.id);
      const comments = Store.getComments(game.id);
      const embedCode = `<iframe src="${window.location.origin}${window.location.pathname}?game=${game.id}" width="800" height="600" frameborder="0"></iframe>`;

      UI.app.innerHTML = `
        <div class="game-detail">
          <button class="back-btn" onclick="history.back()" aria-label="Go back">
            ‚Üê Back to games
          </button>

          <div class="game-header">
            <div class="game-preview">
              <canvas width="400" height="250" id="gamePreviewCanvas"></canvas>
            </div>
            <div class="game-header-info">
              <span class="game-genre">${game.genre}</span>
              <h1>${game.title}</h1>
              <div class="game-stats">
                <div class="stat-item">
                  <span class="stat-value">‚òÖ ${rating}</span>
                  <span class="stat-label">Rating</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">${UI.formatNumber(plays)}</span>
                  <span class="stat-label">Plays</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">${game.developer}</span>
                  <span class="stat-label">Developer</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value">${new Date(game.releaseDate).toLocaleDateString()}</span>
                  <span class="stat-label">Released</span>
                </div>
              </div>
              <div class="game-header-actions">
                <button class="btn btn-primary" onclick="startGame('${game.id}')">
                  ‚ñ∂ Play Now
                </button>
                <button class="btn btn-secondary" onclick="toggleFullscreen()">
                  ‚õ∂ Fullscreen
                </button>
                <button class="btn btn-secondary ${isFav ? 'active' : ''}" id="favBtn" onclick="toggleFavDetail('${game.id}')">
                  ${isFav ? '‚ù§Ô∏è Favorited' : 'ü§ç Add to Favorites'}
                </button>
                <button class="btn btn-secondary" onclick="shareGame('${game.id}')">
                  üì§ Share
                </button>
              </div>
            </div>
          </div>

          <!-- Game Player -->
          <section class="game-player" id="gamePlayer" style="display: none;">
            <div class="player-header">
              <span class="player-title">Now Playing: ${game.title}</span>
              <div class="player-controls">
                <button class="btn btn-sm btn-secondary" onclick="togglePause()">‚è∏ Pause</button>
                <button class="btn btn-sm btn-secondary" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
                <button class="btn btn-sm btn-secondary" onclick="closeGame()">‚úï Close</button>
              </div>
            </div>
            <div id="gameContainer" style="width: 100%; height: 500px; background: #000; display: flex; align-items: center; justify-content: center;">
              <canvas id="demoGameCanvas" width="800" height="500"></canvas>
            </div>
          </section>

          <!-- Description -->
          <section class="game-description">
            <h3>üìñ About This Game</h3>
            <p>${game.description}</p>
            
            <h4 style="margin-top: 20px;">üéÆ Controls</h4>
            <div class="controls-guide">
              ${game.controls.map(c => `
                <div class="control-item">
                  <span class="control-key">${c.key}</span>
                  <span>${c.action}</span>
                </div>
              `).join('')}
            </div>
          </section>

          <!-- Rate This Game -->
          <section class="game-description">
            <h3>‚≠ê Rate This Game</h3>
            <div class="star-rating" id="starRating" role="radiogroup" aria-label="Rate this game">
              ${[1,2,3,4,5].map(i => `
                <span class="star ${i <= userRating ? 'active' : ''}" 
                      data-rating="${i}" 
                      onclick="rateGame('${game.id}', ${i})"
                      role="radio"
                      aria-checked="${i === userRating}"
                      aria-label="${i} star${i > 1 ? 's' : ''}"
                      tabindex="0">‚òÖ</span>
              `).join('')}
            </div>
            <p style="margin-top: 10px; color: var(--text-secondary);">
              ${userRating > 0 ? `You rated this game ${userRating} star${userRating > 1 ? 's' : ''}` : 'Click to rate'}
            </p>
          </section>

          <!-- Embed Code -->
          <section class="embed-section">
            <h3>üîó Embed This Game</h3>
            <p style="color: var(--text-secondary); margin-bottom: 15px;">Copy this code to embed the game on your website:</p>
            <div class="embed-code">
              <code id="embedCode">${embedCode.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code>
              <button class="btn btn-sm btn-primary copy-btn" onclick="copyEmbed()">üìã Copy</button>
            </div>
          </section>

          <!-- Comments -->
          <section class="comments-section">
            <div class="comments-header">
              <h3>üí¨ Comments (${comments.length})</h3>
            </div>

            <form class="comment-form" onsubmit="submitComment(event, '${game.id}')">
              <textarea class="comment-input" id="commentInput" placeholder="${Store.state.currentUser ? 'Write your review...' : 'Login to write a review'}" ${!Store.state.currentUser ? 'disabled' : ''} required></textarea>
              <div class="comment-actions">
                <button type="submit" class="btn btn-primary" ${!Store.state.currentUser ? 'disabled' : ''}>Post Comment</button>
              </div>
            </form>

            <div id="commentsContainer">
              ${comments.length === 0 ? '<p style="color: var(--text-muted); text-align: center; padding: 30px;">No comments yet. Be the first to review!</p>' : ''}
              ${comments.map(c => `
                <article class="comment">
                  <div class="comment-avatar">${c.username?.charAt(0).toUpperCase() || '?'}</div>
                  <div class="comment-content">
                    <div class="comment-header">
                      <span class="comment-author">${c.username || 'Anonymous'}</span>
                      <span class="comment-date">${new Date(c.date).toLocaleDateString()}</span>
                      ${c.rating ? `<div class="comment-rating">${'‚òÖ'.repeat(c.rating)}${'‚òÜ'.repeat(5-c.rating)}</div>` : ''}
                    </div>
                    <p class="comment-text">${c.text}</p>
                  </div>
                </article>
              `).join('')}
            </div>
          </section>
        </div>
      `;

      // Render preview thumbnail
      const canvas = document.getElementById('gamePreviewCanvas');
      UI.renderThumbnail(game, canvas);

      // Increment play count when viewing
      Store.incrementPlays(game.id);
    }

    function startGame(gameId) {
      const game = Store.getGameById(gameId);
      const player = document.getElementById('gamePlayer');
      const container = document.getElementById('gameContainer');
      
      player.style.display = 'block';
      player.scrollIntoView({ behavior: 'smooth' });

      // Check if this is an uploaded game with HTML content
      if (game && game.isUploaded && game.htmlContent) {
        // Create blob URL for the uploaded game
        const blob = new Blob([game.htmlContent], { type: 'text/html' });
        const blobUrl = URL.createObjectURL(blob);
        
        // Create iframe for the uploaded game
        container.innerHTML = `
          <iframe 
            id="uploadedGameFrame" 
            src="${blobUrl}" 
            style="width: 100%; height: 100%; border: none; background: #fff;"
            sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-forms"
            allow="fullscreen"
          ></iframe>
        `;
        
        // Store blob URL for cleanup
        window.currentGameBlobUrl = blobUrl;
        
        // Try to access game API from iframe
        const iframe = document.getElementById('uploadedGameFrame');
        iframe.onload = () => {
          try {
            window.gameAPI = iframe.contentWindow.gameAPI || {
              pause: () => {},
              resume: () => {},
              getScore: () => 0
            };
          } catch (e) {
            // Cross-origin restrictions may prevent access
            window.gameAPI = {
              pause: () => {},
              resume: () => {},
              getScore: () => 0
            };
          }
        };
      } else {
        // Show demo game canvas for built-in games
        container.innerHTML = `<canvas id="demoGameCanvas" width="800" height="500"></canvas>`;
        const canvas = document.getElementById('demoGameCanvas');
        startDemoGame(canvas, gameId);
      }
    }

    function closeGame() {
      document.getElementById('gamePlayer').style.display = 'none';
      
      // Cancel demo game loop if running
      if (window.demoGameLoop) {
        cancelAnimationFrame(window.demoGameLoop);
      }
      
      // Clean up blob URL for uploaded games
      if (window.currentGameBlobUrl) {
        URL.revokeObjectURL(window.currentGameBlobUrl);
        window.currentGameBlobUrl = null;
      }
      
      // Reset game container
      const container = document.getElementById('gameContainer');
      if (container) {
        container.innerHTML = `<canvas id="demoGameCanvas" width="800" height="500"></canvas>`;
      }
    }

    function toggleFullscreen() {
      const container = document.getElementById('gameContainer');
      const iframe = document.getElementById('uploadedGameFrame');
      
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        // For uploaded games, try to fullscreen the iframe first
        if (iframe) {
          iframe.requestFullscreen().catch(() => {
            container.requestFullscreen();
          });
        } else {
          container.requestFullscreen();
        }
      }
    }

    // Demo game (simple space shooter)
    function startDemoGame(canvas, gameId) {
      const ctx = canvas.getContext('2d');
      const game = Store.getGameById(gameId);
      
      let player = { x: canvas.width / 2 - 25, y: canvas.height - 60, width: 50, height: 40, speed: 8 };
      let bullets = [];
      let enemies = [];
      let score = 0;
      let gameOver = false;
      let paused = false;
      let keys = {};

      // Spawn enemies periodically
      function spawnEnemy() {
        if (!paused && !gameOver) {
          enemies.push({
            x: Math.random() * (canvas.width - 40),
            y: -40,
            width: 40,
            height: 40,
            speed: 2 + Math.random() * 3
          });
        }
      }
      setInterval(spawnEnemy, 1000);

      // Input handling
      document.addEventListener('keydown', e => keys[e.key] = true);
      document.addEventListener('keyup', e => keys[e.key] = false);

      window.togglePause = () => {
        paused = !paused;
        UI.showToast(paused ? 'Game Paused' : 'Game Resumed');
      };

      // Expose game API
      window.gameAPI = {
        pause: () => { paused = true; },
        resume: () => { paused = false; },
        getScore: () => score,
        onGameOver: null
      };

      function update() {
        if (paused || gameOver) return;

        // Move player
        if (keys['ArrowLeft'] || keys['a']) player.x = Math.max(0, player.x - player.speed);
        if (keys['ArrowRight'] || keys['d']) player.x = Math.min(canvas.width - player.width, player.x + player.speed);

        // Shoot
        if (keys[' '] && bullets.length < 5) {
          bullets.push({ x: player.x + player.width / 2 - 3, y: player.y, width: 6, height: 15 });
          keys[' '] = false;
        }

        // Update bullets
        bullets.forEach((b, i) => {
          b.y -= 10;
          if (b.y < 0) bullets.splice(i, 1);
        });

        // Update enemies
        enemies.forEach((e, i) => {
          e.y += e.speed;
          if (e.y > canvas.height) enemies.splice(i, 1);

          // Collision with player
          if (e.x < player.x + player.width && e.x + e.width > player.x &&
              e.y < player.y + player.height && e.y + e.height > player.y) {
            gameOver = true;
            if (window.gameAPI.onGameOver) window.gameAPI.onGameOver(score);
          }

          // Collision with bullets
          bullets.forEach((b, bi) => {
            if (b.x < e.x + e.width && b.x + b.width > e.x &&
                b.y < e.y + e.height && b.y + b.height > e.y) {
              enemies.splice(i, 1);
              bullets.splice(bi, 1);
              score += 100;
            }
          });
        });
      }

      function draw() {
        // Clear
        ctx.fillStyle = '#0a0a1a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Stars background
        ctx.fillStyle = '#fff';
        for (let i = 0; i < 50; i++) {
          const x = (i * 47) % canvas.width;
          const y = ((i * 73) + Date.now() * 0.02) % canvas.height;
          ctx.fillRect(x, y, 2, 2);
        }

        // Player
        ctx.fillStyle = game?.thumbnailColor || '#00bfff';
        ctx.beginPath();
        ctx.moveTo(player.x + player.width / 2, player.y);
        ctx.lineTo(player.x, player.y + player.height);
        ctx.lineTo(player.x + player.width, player.y + player.height);
        ctx.closePath();
        ctx.fill();

        // Bullets
        ctx.fillStyle = '#ffff00';
        bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));

        // Enemies
        ctx.fillStyle = '#ff4444';
        enemies.forEach(e => {
          ctx.beginPath();
          ctx.arc(e.x + e.width / 2, e.y + e.height / 2, e.width / 2, 0, Math.PI * 2);
          ctx.fill();
        });

        // Score
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 20px Inter';
        ctx.fillText(`Score: ${score}`, 20, 35);

        // Game over screen
        if (gameOver) {
          ctx.fillStyle = 'rgba(0,0,0,0.7)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#fff';
          ctx.font = 'bold 48px Orbitron';
          ctx.textAlign = 'center';
          ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
          ctx.font = '24px Inter';
          ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2 + 30);
          ctx.fillText('Press R to restart', canvas.width / 2, canvas.height / 2 + 70);
          ctx.textAlign = 'left';
        }

        // Pause screen
        if (paused && !gameOver) {
          ctx.fillStyle = 'rgba(0,0,0,0.7)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#fff';
          ctx.font = 'bold 36px Orbitron';
          ctx.textAlign = 'center';
          ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2);
          ctx.textAlign = 'left';
        }
      }

      function gameLoop() {
        update();
        draw();
        window.demoGameLoop = requestAnimationFrame(gameLoop);
      }

      // Restart handler
      document.addEventListener('keydown', e => {
        if (e.key === 'r' && gameOver) {
          player = { x: canvas.width / 2 - 25, y: canvas.height - 60, width: 50, height: 40, speed: 8 };
          bullets = [];
          enemies = [];
          score = 0;
          gameOver = false;
        }
      });

      gameLoop();
    }

    function rateGame(gameId, rating) {
      if (!Store.state.currentUser) {
        UI.showToast('Please login to rate games', 'warning');
        openAuthModal();
        return;
      }

      Store.rateGame(gameId, rating);
      
      // Update stars UI
      document.querySelectorAll('.star-rating .star').forEach((star, i) => {
        star.classList.toggle('active', i < rating);
        star.setAttribute('aria-checked', i + 1 === rating);
      });

      UI.showToast(`You rated this game ${rating} star${rating > 1 ? 's' : ''}!`, 'success');
    }

    function submitComment(event, gameId) {
      event.preventDefault();
      const input = document.getElementById('commentInput');
      const text = input.value.trim();
      
      if (!text) return;

      const userRating = Store.getUserRating(gameId);
      Store.addComment(gameId, text, userRating);
      
      input.value = '';
      UI.showToast('Comment posted!', 'success');
      
      // Re-render game page
      renderGameDetail(gameId);
    }

    function toggleFavDetail(gameId) {
      const isFav = Store.toggleFavorite(gameId);
      const btn = document.getElementById('favBtn');
      btn.innerHTML = isFav ? '‚ù§Ô∏è Favorited' : 'ü§ç Add to Favorites';
      btn.classList.toggle('active', isFav);
      UI.showToast(isFav ? 'Added to favorites!' : 'Removed from favorites', isFav ? 'success' : '');
      UI.updateSidebar();
    }

    function shareGame(gameId) {
      const url = `${window.location.origin}${window.location.pathname}#game=${gameId}`;
      if (navigator.share) {
        navigator.share({ title: 'Check out this game!', url });
      } else {
        navigator.clipboard.writeText(url);
        UI.showToast('Link copied to clipboard!', 'success');
      }
    }

    function copyEmbed() {
      const code = document.getElementById('embedCode').textContent;
      navigator.clipboard.writeText(code.replace(/&lt;/g, '<').replace(/&gt;/g, '>'));
      UI.showToast('Embed code copied!', 'success');
    }

    // FAVORITES PAGE
    function renderFavorites() {
      const favoriteIds = Store.getFavorites();
      const favorites = favoriteIds.map(id => Store.getGameById(id)).filter(Boolean);

      UI.app.innerHTML = `
        <h1 class="section-title" style="margin-bottom: 25px;">‚ù§Ô∏è My Favorites</h1>
        ${favorites.length === 0 ? `
          <div class="favorites-empty">
            <div class="favorites-empty-icon">üíî</div>
            <h3>No favorites yet</h3>
            <p>Start exploring games and add them to your favorites!</p>
            <button class="btn btn-primary" onclick="Router.navigate('catalog')">Browse Games</button>
          </div>
        ` : `
          <div class="games-grid" id="favoritesGrid"></div>
        `}
      `;

      if (favorites.length > 0) {
        const grid = document.getElementById('favoritesGrid');
        favorites.forEach(game => {
          grid.appendChild(UI.createGameCard(game));
        });
      }
    }

    // MY GAMES (Developer Portal)
    function renderMyGames() {
      const user = Store.state.currentUser;

      if (!user) {
        UI.app.innerHTML = `
          <div class="favorites-empty">
            <div class="favorites-empty-icon">üîê</div>
            <h3>Login Required</h3>
            <p>Please login to access the developer portal</p>
            <button class="btn btn-primary" onclick="openAuthModal()">Login</button>
          </div>
        `;
        return;
      }

      // Get user's uploaded games
      const userGames = Store.getUserUploadedGames();
      
      // Calculate analytics for user's games
      const userTotalPlays = userGames.reduce((sum, g) => sum + Store.getGamePlays(g.id), 0);
      const userAvgRating = userGames.length > 0 
        ? (userGames.reduce((sum, g) => sum + parseFloat(Store.getGameRating(g.id) || 0), 0) / userGames.length).toFixed(1)
        : '0.0';
      const userTotalComments = userGames.reduce((sum, g) => sum + (Store.state.comments[g.id]?.length || 0), 0);

      UI.app.innerHTML = `
        <div class="dev-portal-header">
          <h1 class="section-title">üéÆ Developer Portal</h1>
          <button class="btn btn-primary" onclick="openUploadModal()">+ Upload New Game</button>
        </div>

        <!-- Analytics Overview -->
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-icon">üéÆ</div>
            <div class="analytics-value">${userGames.length}</div>
            <div class="analytics-label">Your Games</div>
            <div class="analytics-trend up">Upload more!</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">üìä</div>
            <div class="analytics-value">${UI.formatNumber(userTotalPlays)}</div>
            <div class="analytics-label">Total Plays</div>
            <div class="analytics-trend up">‚Üë Keep growing</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">‚≠ê</div>
            <div class="analytics-value">${userAvgRating}</div>
            <div class="analytics-label">Avg Rating</div>
            <div class="analytics-trend ${parseFloat(userAvgRating) >= 3 ? 'up' : ''}">${parseFloat(userAvgRating) >= 3 ? '‚Üë Great!' : 'Keep improving'}</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">üí¨</div>
            <div class="analytics-value">${userTotalComments}</div>
            <div class="analytics-label">Reviews</div>
            <div class="analytics-trend up">Community feedback</div>
          </div>
        </div>

        <!-- Uploaded Games Table -->
        <h2 class="section-title" style="margin: 30px 0 20px;">Your Uploaded Games</h2>
        ${userGames.length === 0 ? `
          <div class="favorites-empty" style="padding: 40px;">
            <div class="favorites-empty-icon">üöÄ</div>
            <h3>No games uploaded yet</h3>
            <p>Upload your first HTML5 game and share it with the world!</p>
            <button class="btn btn-primary" onclick="openUploadModal()">Upload Your First Game</button>
          </div>
        ` : `
          <div class="games-table">
            <table role="table">
              <thead>
                <tr>
                  <th scope="col">Game</th>
                  <th scope="col">Genre</th>
                  <th scope="col">Plays</th>
                  <th scope="col">Rating</th>
                  <th scope="col">Uploaded</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${userGames.map(game => `
                  <tr>
                    <td>
                      <div class="table-game">
                        <div class="table-thumb">
                          <canvas width="60" height="40" data-game-id="${game.id}"></canvas>
                        </div>
                        <span>${game.title}</span>
                      </div>
                    </td>
                    <td>${game.genre}</td>
                    <td>${UI.formatNumber(Store.getGamePlays(game.id))}</td>
                    <td>‚òÖ ${Store.getGameRating(game.id) || '0.0'}</td>
                    <td>${new Date(game.uploadedAt).toLocaleDateString()}</td>
                    <td>
                      <div class="table-actions">
                        <button class="btn btn-sm btn-secondary" onclick="Router.navigate('game=${game.id}')">View</button>
                        <button class="btn btn-sm btn-secondary" onclick="copyGameEmbed('${game.id}')">Embed</button>
                        <button class="btn btn-sm btn-secondary delete-game-btn" onclick="confirmDeleteGame('${game.id}')">Delete</button>
                      </div>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `}

        <!-- Quick Tips -->
        <div class="game-description" style="margin-top: 30px;">
          <h3>üí° Tips for Uploading Games</h3>
          <ul style="margin-top: 15px; padding-left: 20px; color: var(--text-secondary); line-height: 2;">
            <li>Your HTML file should be self-contained (CSS and JS inline or embedded)</li>
            <li>External resources may not load correctly - embed images as base64</li>
            <li>Maximum file size is 5MB</li>
            <li>Games run in an isolated iframe for security</li>
            <li>Use <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">window.gameAPI</code> to expose pause/resume controls</li>
          </ul>
        </div>
      `;

      // Render table thumbnails
      document.querySelectorAll('.table-thumb canvas').forEach(canvas => {
        const game = Store.getGameById(canvas.dataset.gameId);
        if (game) UI.renderThumbnail(game, canvas);
      });
    }

    function copyGameEmbed(gameId) {
      const embedCode = `<iframe src="${window.location.origin}${window.location.pathname}#game=${gameId}" width="800" height="600" frameborder="0"></iframe>`;
      navigator.clipboard.writeText(embedCode);
      UI.showToast('Embed code copied!', 'success');
    }

    function confirmDeleteGame(gameId) {
      const game = Store.getGameById(gameId);
      if (!game) return;
      
      if (confirm(`Are you sure you want to delete "${game.title}"? This action cannot be undone.`)) {
        if (Store.deleteGame(gameId)) {
          UI.showToast(`"${game.title}" has been deleted`, 'success');
          renderMyGames();
          UI.updateSidebar();
        } else {
          UI.showToast('Failed to delete game', 'error');
        }
      }
    }

    // ============================================
    // AUTH MODAL
    // ============================================
    const authModal = document.getElementById('authModal');
    let isRegisterMode = false;

    function openAuthModal() {
      authModal.classList.add('active');
      document.getElementById('authEmail').focus();
    }

    function closeAuthModal() {
      authModal.classList.remove('active');
      document.getElementById('authForm').reset();
      clearAuthErrors();
    }

    function clearAuthErrors() {
      ['username', 'email', 'password'].forEach(field => {
        document.getElementById(`${field}Error`).textContent = '';
      });
    }

    function toggleAuthMode() {
      isRegisterMode = !isRegisterMode;
      document.getElementById('authModalTitle').textContent = isRegisterMode ? 'Register' : 'Login';
      document.getElementById('authSubmitBtn').textContent = isRegisterMode ? 'Register' : 'Login';
      document.getElementById('authToggleText').textContent = isRegisterMode ? 'Already have an account?' : "Don't have an account?";
      document.getElementById('authToggle').textContent = isRegisterMode ? 'Login' : 'Register';
      document.getElementById('usernameGroup').style.display = isRegisterMode ? 'block' : 'none';
      clearAuthErrors();
    }

    function handleAuth() {
      clearAuthErrors();
      const email = document.getElementById('authEmail').value;
      const password = document.getElementById('authPassword').value;
      const username = document.getElementById('authUsername').value;

      if (isRegisterMode) {
        if (!username || username.length < 3) {
          document.getElementById('usernameError').textContent = 'Username must be at least 3 characters';
          return;
        }
        if (password.length < 6) {
          document.getElementById('passwordError').textContent = 'Password must be at least 6 characters';
          return;
        }

        const result = UserService.register(username, email, password);
        if (result.success) {
          UserService.login(email, password);
          closeAuthModal();
          UI.updateSidebar();
          UI.showToast(`Welcome, ${username}!`, 'success');
          Router.handleRoute();
        } else {
          document.getElementById('emailError').textContent = result.error;
        }
      } else {
        const result = UserService.login(email, password);
        if (result.success) {
          closeAuthModal();
          UI.updateSidebar();
          UI.showToast(`Welcome back, ${result.user.username}!`, 'success');
          Router.handleRoute();
        } else {
          document.getElementById('emailError').textContent = result.error;
        }
      }
    }

    // Auth modal event listeners
    document.getElementById('authModalClose').addEventListener('click', closeAuthModal);
    document.getElementById('authCancelBtn').addEventListener('click', closeAuthModal);
    document.getElementById('authSubmitBtn').addEventListener('click', handleAuth);
    document.getElementById('authToggle').addEventListener('click', e => {
      e.preventDefault();
      toggleAuthMode();
    });
    document.getElementById('authForm').addEventListener('submit', e => {
      e.preventDefault();
      handleAuth();
    });
    document.getElementById('userAvatar').addEventListener('click', () => {
      if (Store.state.currentUser) {
        Router.navigate('my-games');
      } else {
        openAuthModal();
      }
    });
    document.getElementById('mobileLoginBtn').addEventListener('click', e => {
      e.preventDefault();
      document.getElementById('mobileMenu').classList.remove('active');
      if (Store.state.currentUser) {
        Router.navigate('my-games');
      } else {
        openAuthModal();
      }
    });

    // Close modal on overlay click
    authModal.addEventListener('click', e => {
      if (e.target === authModal) closeAuthModal();
    });

    // ============================================
    // UPLOAD GAME MODAL
    // ============================================
    const uploadModal = document.getElementById('uploadModal');
    let uploadedFileContent = null;

    function openUploadModal() {
      if (!Store.state.currentUser) {
        UI.showToast('Please login to upload games', 'warning');
        openAuthModal();
        return;
      }
      uploadModal.classList.add('active');
      resetUploadForm();
    }

    function closeUploadModal() {
      uploadModal.classList.remove('active');
      resetUploadForm();
    }

    function resetUploadForm() {
      document.getElementById('uploadForm').reset();
      document.getElementById('fileName').textContent = '';
      document.getElementById('fileUploadArea').classList.remove('has-file');
      document.getElementById('descCharCount').textContent = '0';
      document.getElementById('colorValue').textContent = '#1a237e';
      document.getElementById('fileError').textContent = '';
      document.getElementById('titleError').textContent = '';
      uploadedFileContent = null;
      
      // Reset controls to single row
      const container = document.getElementById('controlsContainer');
      container.innerHTML = `
        <div class="control-row">
          <input type="text" class="form-input control-key-input" placeholder="Key (e.g. WASD)">
          <input type="text" class="form-input control-action-input" placeholder="Action (e.g. Move)">
          <button type="button" class="btn-icon-small" onclick="removeControlRow(this)">‚úï</button>
        </div>
      `;
    }

    function addControlRow() {
      const container = document.getElementById('controlsContainer');
      const row = document.createElement('div');
      row.className = 'control-row';
      row.innerHTML = `
        <input type="text" class="form-input control-key-input" placeholder="Key (e.g. Space)">
        <input type="text" class="form-input control-action-input" placeholder="Action (e.g. Jump)">
        <button type="button" class="btn-icon-small" onclick="removeControlRow(this)">‚úï</button>
      `;
      container.appendChild(row);
    }

    function removeControlRow(btn) {
      const container = document.getElementById('controlsContainer');
      if (container.children.length > 1) {
        btn.parentElement.remove();
      }
    }

    // File upload handling
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('gameFile');

    fileUploadArea.addEventListener('dragover', e => {
      e.preventDefault();
      fileUploadArea.classList.add('dragover');
    });

    fileUploadArea.addEventListener('dragleave', e => {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
    });

    fileUploadArea.addEventListener('drop', e => {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFileSelect(files[0]);
      }
    });

    fileInput.addEventListener('change', e => {
      if (e.target.files.length > 0) {
        handleFileSelect(e.target.files[0]);
      }
    });

    function handleFileSelect(file) {
      const fileError = document.getElementById('fileError');
      const fileName = document.getElementById('fileName');
      
      // Validate file type
      if (!file.name.match(/\.(html|htm)$/i)) {
        fileError.textContent = 'Please select an HTML file (.html or .htm)';
        return;
      }

      // Validate file size (5MB max)
      if (file.size > 5 * 1024 * 1024) {
        fileError.textContent = 'File size must be less than 5MB';
        return;
      }

      fileError.textContent = '';
      fileName.textContent = file.name;
      fileUploadArea.classList.add('has-file');

      // Read file content
      const reader = new FileReader();
      reader.onload = e => {
        uploadedFileContent = e.target.result;
        
        // Auto-fill title from filename if empty
        const titleInput = document.getElementById('gameTitle');
        if (!titleInput.value) {
          const name = file.name.replace(/\.(html|htm)$/i, '');
          titleInput.value = name.charAt(0).toUpperCase() + name.slice(1);
        }
      };
      reader.onerror = () => {
        fileError.textContent = 'Error reading file';
        uploadedFileContent = null;
      };
      reader.readAsText(file);
    }

    // Description character counter
    document.getElementById('gameDescription').addEventListener('input', e => {
      document.getElementById('descCharCount').textContent = e.target.value.length;
    });

    // Color picker
    document.getElementById('gameThumbnailColor').addEventListener('input', e => {
      document.getElementById('colorValue').textContent = e.target.value;
    });

    // Submit upload
    function handleUploadSubmit() {
      const fileError = document.getElementById('fileError');
      const titleError = document.getElementById('titleError');
      
      // Clear errors
      fileError.textContent = '';
      titleError.textContent = '';

      // Validate
      if (!uploadedFileContent) {
        fileError.textContent = 'Please select an HTML file';
        return;
      }

      const title = document.getElementById('gameTitle').value.trim();
      if (!title || title.length < 2) {
        titleError.textContent = 'Title must be at least 2 characters';
        return;
      }

      const genre = document.getElementById('gameGenre').value;
      if (!genre) {
        UI.showToast('Please select a genre', 'warning');
        return;
      }

      const description = document.getElementById('gameDescription').value.trim();
      if (!description || description.length < 10) {
        UI.showToast('Description must be at least 10 characters', 'warning');
        return;
      }

      // Collect controls
      const controls = [];
      document.querySelectorAll('.control-row').forEach(row => {
        const key = row.querySelector('.control-key-input').value.trim();
        const action = row.querySelector('.control-action-input').value.trim();
        if (key && action) {
          controls.push({ key, action });
        }
      });

      // Create game data
      const gameData = {
        title,
        genre,
        description,
        players: document.getElementById('gamePlayers').value,
        thumbnailColor: document.getElementById('gameThumbnailColor').value,
        htmlContent: uploadedFileContent,
        controls
      };

      // Upload game
      const game = Store.uploadGame(gameData);
      
      closeUploadModal();
      UI.showToast(`"${game.title}" uploaded successfully!`, 'success');
      UI.updateSidebar();
      
      // Navigate to the game page
      Router.navigate(`game=${game.id}`);
    }

    // Upload modal event listeners
    document.getElementById('uploadModalClose').addEventListener('click', closeUploadModal);
    document.getElementById('uploadCancelBtn').addEventListener('click', closeUploadModal);
    document.getElementById('uploadSubmitBtn').addEventListener('click', handleUploadSubmit);
    
    uploadModal.addEventListener('click', e => {
      if (e.target === uploadModal) closeUploadModal();
    });

    document.getElementById('uploadForm').addEventListener('submit', e => {
      e.preventDefault();
      handleUploadSubmit();
    });

    // ============================================
    // MOBILE MENU
    // ============================================
    const hamburger = document.getElementById('hamburgerBtn');
    const mobileMenu = document.getElementById('mobileMenu');

    hamburger.addEventListener('click', () => {
      const isOpen = mobileMenu.classList.toggle('active');
      hamburger.setAttribute('aria-expanded', isOpen);
    });

    // ============================================
    // SEARCH FUNCTIONALITY
    // ============================================
    const searchInput = document.getElementById('searchInput');

    searchInput.addEventListener('input', debounce(e => {
      Store.state.searchQuery = e.target.value.trim();
      if (window.location.hash.includes('catalog')) {
        renderCatalogGames();
      } else if (Store.state.searchQuery) {
        Router.navigate('catalog');
      }
    }, 300));

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // ============================================
    // KEYBOARD SHORTCUTS
    // ============================================
    document.addEventListener('keydown', e => {
      // Focus search on /
      if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
        e.preventDefault();
        searchInput.focus();
      }

      // Close modals on Escape
      if (e.key === 'Escape') {
        closeAuthModal();
        mobileMenu.classList.remove('active');
        closeGame();
      }
    });

    // ============================================
    // ACCESSIBILITY: High Contrast Toggle
    // ============================================
    document.getElementById('contrastToggle').addEventListener('click', () => {
      document.body.classList.toggle('high-contrast');
      const isHighContrast = document.body.classList.contains('high-contrast');
      UI.showToast(isHighContrast ? 'High contrast mode enabled' : 'High contrast mode disabled');
    });

    // ============================================
    // LAZY LOADING (Intersection Observer)
    // ============================================
    const lazyLoadObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const canvas = entry.target;
          const gameId = canvas.dataset.gameId;
          if (gameId) {
            const game = Store.getGameById(gameId);
            if (game) UI.renderThumbnail(game, canvas);
          }
          lazyLoadObserver.unobserve(canvas);
        }
      });
    }, { rootMargin: '100px' });

    // ============================================
    // INITIALIZE APP
    // ============================================
    function init() {
      // Initialize store
      Store.init();

      // Register routes
      Router.register('home', renderHome);
      Router.register('catalog', renderCatalog);
      Router.register('game', renderGameDetail);
      Router.register('favorites', renderFavorites);
      Router.register('my-games', renderMyGames);

      // Initialize router
      Router.init();

      // Update sidebar
      UI.updateSidebar();

      // Handle URL params for embed
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('game')) {
        Router.navigate(`game=${urlParams.get('game')}`);
      }

      // Hide loading screen
      setTimeout(() => {
        document.getElementById('loadingScreen').style.display = 'none';
      }, 500);
    }

    // Start the app
    init();
  </script>
</body>
</html>
