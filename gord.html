<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Builder - –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å</title>
    <style>
        /* ==================== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            overflow: hidden;
            user-select: none;
        }

        /* ==================== –¢–ò–¢–£–õ–¨–ù–´–ô –≠–ö–†–ê–ù ==================== */
        #title-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        #title-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #title-screen h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(100, 200, 255, 0.5);
        }

        #title-screen p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #aaa;
        }

        .title-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .title-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-load {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-load:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* ==================== –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ==================== */
        #game-container {
            display: none;
            width: 100%;
            height: 100vh;
        }

        #game-container.active {
            display: flex;
            flex-direction: column;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        #top-panel {
            height: 60px;
            background: linear-gradient(180deg, #2d2d44 0%, #1a1a2e 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 2px solid #3d3d5c;
            flex-shrink: 0;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .stat-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        #balance-display {
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.3rem;
            transition: color 0.3s;
        }

        #balance-display.negative {
            color: #f44336;
        }

        #month-display {
            color: #64b5f6;
        }

        #day-display {
            color: #aaa;
            font-size: 0.9rem;
        }

        .top-buttons {
            display: flex;
            gap: 10px;
        }

        .top-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .btn-save {
            background: #4CAF50;
            color: white;
        }

        .btn-save:hover {
            background: #45a049;
        }

        .btn-menu {
            background: #f44336;
            color: white;
        }

        .btn-menu:hover {
            background: #d32f2f;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        #main-area {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ==================== –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê) ==================== */
        #side-panel {
            width: 220px;
            background: #2d2d44;
            border-right: 2px solid #3d3d5c;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow-y: auto;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 2px solid #3d3d5c;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: #1a1a2e;
            color: #888;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #3d3d5c;
            color: #fff;
        }

        .tab-btn.active {
            background: #4a4a6a;
            color: #fff;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-content {
            display: none;
            padding: 10px;
            flex-direction: column;
            gap: 8px;
        }

        .tab-content.active {
            display: flex;
        }

        .build-item {
            background: #3d3d5c;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .build-item:hover {
            background: #4a4a6a;
            transform: translateX(5px);
        }

        .build-item.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }

        .build-item-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .build-icon {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .build-name {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .build-cost {
            font-size: 0.8rem;
            color: #4CAF50;
        }

        .build-desc {
            font-size: 0.75rem;
            color: #aaa;
        }

        /* –¶–≤–µ—Ç–∞ –∑–æ–Ω */
        .zone-industrial { background: #8B0000; }
        .zone-commercial { background: #FFD700; color: #000; }
        .zone-residential { background: #32CD32; }
        .zone-road { background: #696969; }
        .zone-service { background: #9C27B0; }

        /* ==================== –ò–ì–†–û–í–û–ï –ü–û–õ–ï ==================== */
        #game-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: #e8e4d9;
        }

        #game-canvas-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        #game-canvas {
            position: absolute;
            cursor: crosshair;
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑—É–º–µ */
        #zoom-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        /* ==================== –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ==================== */
        #notifications {
            position: fixed;
            top: 70px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 500;
        }

        .notification {
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            max-width: 300px;
        }

        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }
        .notification.warning { background: #FF9800; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* ==================== –ö–ê–†–¢–û–ß–ö–ê –ó–î–ê–ù–ò–Ø ==================== */
        #building-info {
            position: fixed;
            background: #2d2d44;
            border: 2px solid #4a4a6a;
            border-radius: 12px;
            padding: 15px;
            min-width: 250px;
            z-index: 600;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        #building-info.visible {
            display: block;
            animation: popIn 0.2s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #4a4a6a;
        }

        .info-title {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .info-close {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .info-close:hover {
            color: #fff;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .info-label { color: #aaa; }
        .info-value { font-weight: bold; }
        .info-value.positive { color: #4CAF50; }
        .info-value.negative { color: #f44336; }

        .btn-demolish {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
            background: #f44336;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-demolish:hover {
            background: #d32f2f;
        }

        /* ==================== –ú–ï–°–Ø–ß–ù–´–ô –û–¢–ß–Å–¢ ==================== */
        #monthly-report {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d44;
            border: 2px solid #4a4a6a;
            border-radius: 16px;
            padding: 25px;
            min-width: 350px;
            z-index: 700;
            display: none;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
        }

        #monthly-report.visible {
            display: block;
            animation: popIn 0.3s ease;
        }

        .report-title {
            font-size: 1.4rem;
            text-align: center;
            margin-bottom: 20px;
            color: #64b5f6;
        }

        .report-section {
            margin-bottom: 15px;
        }

        .report-section-title {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .report-close {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background: #4CAF50;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }

        /* ==================== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ==================== */
        @media (max-width: 768px) {
            #side-panel {
                width: 180px;
            }

            .build-item {
                padding: 8px;
            }

            .build-name {
                font-size: 0.8rem;
            }

            #top-panel {
                padding: 0 10px;
                height: 50px;
            }

            .stat-item {
                font-size: 0.9rem;
            }

            #title-screen h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== –¢–ò–¢–£–õ–¨–ù–´–ô –≠–ö–†–ê–ù ==================== -->
    <div id="title-screen">
        <h1>üèôÔ∏è City Builder</h1>
        <p>–ü–æ—Å—Ç—Ä–æ–π –≥–æ—Ä–æ–¥ —Å–≤–æ–µ–π –º–µ—á—Ç—ã</p>
        <button class="title-btn btn-start" onclick="startNewGame()">üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        <button class="title-btn btn-load" id="btn-continue" onclick="loadGame()" disabled>üìÇ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <!-- ==================== –ò–ì–†–û–í–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ==================== -->
    <div id="game-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div id="top-panel">
            <div class="stat-item">
                <span class="stat-icon">üí∞</span>
                <span id="balance-display">$500,000</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">üìÖ</span>
                <span id="month-display">–ú–µ—Å—è—Ü 1</span>
                <span id="day-display">(–î–µ–Ω—å 1)</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">üë•</span>
                <span id="population-display">0</span>
            </div>
            <div class="top-buttons">
                <button class="top-btn btn-save" onclick="saveGame()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="top-btn btn-menu" onclick="returnToMenu()">üè† –ú–µ–Ω—é</button>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div id="main-area">
            <!-- ==================== –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê ==================== -->
            <div id="side-panel">
                <div class="panel-tabs">
                    <button class="tab-btn active" data-tab="roads">üõ§Ô∏è</button>
                    <button class="tab-btn" data-tab="zones">üèóÔ∏è</button>
                    <button class="tab-btn" data-tab="services">üè•</button>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –î–æ—Ä–æ–≥–∏ -->
                <div class="tab-content active" id="tab-roads">
                    <div class="build-item" data-type="road" data-building="road">
                        <div class="build-item-header">
                            <div class="build-icon zone-road">üõ§Ô∏è</div>
                            <div>
                                <div class="build-name">–î–æ—Ä–æ–≥–∞</div>
                                <div class="build-cost">$1,000</div>
                            </div>
                        </div>
                        <div class="build-desc">–ó–∞–∂–º–∏—Ç–µ –º—ã—à—å –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è</div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –ó–æ–Ω—ã -->
                <div class="tab-content" id="tab-zones">
                    <h4 style="color: #8B0000; margin-bottom: 8px;">üè≠ –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å</h4>
                    <div class="build-item" data-type="industrial" data-building="iron_factory">
                        <div class="build-item-header">
                            <div class="build-icon zone-industrial">üè≠</div>
                            <div>
                                <div class="build-name">–ó–∞–≤–æ–¥ –∂–µ–ª–µ–∑–∞</div>
                                <div class="build-cost">$50,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+10 –∂–µ–ª–µ–∑–∞/–º–µ—Å (+$1,000)</div>
                    </div>
                    <div class="build-item" data-type="industrial" data-building="warehouse">
                        <div class="build-item-header">
                            <div class="build-icon zone-industrial">üì¶</div>
                            <div>
                                <div class="build-name">–°–∫–ª–∞–¥</div>
                                <div class="build-cost">$30,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+$2,000/–º–µ—Å</div>
                    </div>
                    <div class="build-item" data-type="industrial" data-building="goods_factory">
                        <div class="build-item-header">
                            <div class="build-icon zone-industrial">‚öôÔ∏è</div>
                            <div>
                                <div class="build-name">–§–∞–±—Ä–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤</div>
                                <div class="build-cost">$80,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+$5,000/–º–µ—Å</div>
                    </div>

                    <h4 style="color: #FFD700; margin: 12px 0 8px;">üè™ –ö–æ–º–º–µ—Ä—Ü–∏—è</h4>
                    <div class="build-item" data-type="commercial" data-building="shop">
                        <div class="build-item-header">
                            <div class="build-icon zone-commercial">üè™</div>
                            <div>
                                <div class="build-name">–ú–∞–≥–∞–∑–∏–Ω</div>
                                <div class="build-cost">$30,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+$5,000/–º–µ—Å</div>
                    </div>
                    <div class="build-item" data-type="commercial" data-building="mall">
                        <div class="build-item-header">
                            <div class="build-icon zone-commercial">üè¨</div>
                            <div>
                                <div class="build-name">–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä</div>
                                <div class="build-cost">$150,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+$20,000/–º–µ—Å</div>
                    </div>
                    <div class="build-item" data-type="commercial" data-building="cafe">
                        <div class="build-item-header">
                            <div class="build-icon zone-commercial">‚òï</div>
                            <div>
                                <div class="build-name">–ö–∞—Ñ–µ</div>
                                <div class="build-cost">$20,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+$3,000/–º–µ—Å</div>
                    </div>

                    <h4 style="color: #32CD32; margin: 12px 0 8px;">üè† –ñ–∏–ª–∞—è –∑–æ–Ω–∞</h4>
                    <div class="build-item" data-type="residential" data-building="house">
                        <div class="build-item-header">
                            <div class="build-icon zone-residential">üè†</div>
                            <div>
                                <div class="build-name">–î–æ–º</div>
                                <div class="build-cost">$20,000</div>
                            </div>
                        </div>
                        <div class="build-desc">4 –∂–∏—Ç–µ–ª—è, –Ω–∞–ª–æ–≥ –æ—Ç —Å—á–∞—Å—Ç—å—è</div>
                    </div>
                    <div class="build-item" data-type="residential" data-building="apartment">
                        <div class="build-item-header">
                            <div class="build-icon zone-residential">üè¢</div>
                            <div>
                                <div class="build-name">–ú–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–π –¥–æ–º</div>
                                <div class="build-cost">$80,000</div>
                            </div>
                        </div>
                        <div class="build-desc">20 –∂–∏—Ç–µ–ª–µ–π, –Ω–∞–ª–æ–≥ –æ—Ç —Å—á–∞—Å—Ç—å—è</div>
                    </div>
                    <div class="build-item" data-type="residential" data-building="cottage">
                        <div class="build-item-header">
                            <div class="build-icon zone-residential">üè°</div>
                            <div>
                                <div class="build-name">–≠–ª–∏—Ç–Ω—ã–π –∫–æ—Ç—Ç–µ–¥–∂</div>
                                <div class="build-cost">$100,000</div>
                            </div>
                        </div>
                        <div class="build-desc">2 –∂–∏—Ç–µ–ª—è, –≤—ã—Å–æ–∫–∏–π –Ω–∞–ª–æ–≥</div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞: –°–ª—É–∂–±—ã -->
                <div class="tab-content" id="tab-services">
                    <div class="build-item" data-type="service" data-building="police">
                        <div class="build-item-header">
                            <div class="build-icon zone-service">üöî</div>
                            <div>
                                <div class="build-name">–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π —É—á–∞—Å—Ç–æ–∫</div>
                                <div class="build-cost">$100,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+10 —Å—á–∞—Å—Ç—å—è (—Ä–∞–¥–∏—É—Å 3)</div>
                    </div>
                    <div class="build-item" data-type="service" data-building="hospital">
                        <div class="build-item-header">
                            <div class="build-icon zone-service">üè•</div>
                            <div>
                                <div class="build-name">–ë–æ–ª—å–Ω–∏—Ü–∞</div>
                                <div class="build-cost">$150,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+15 —Å—á–∞—Å—Ç—å—è (—Ä–∞–¥–∏—É—Å 3)</div>
                    </div>
                    <div class="build-item" data-type="service" data-building="fire_station">
                        <div class="build-item-header">
                            <div class="build-icon zone-service">üöí</div>
                            <div>
                                <div class="build-name">–ü–æ–∂–∞—Ä–Ω–∞—è —á–∞—Å—Ç—å</div>
                                <div class="build-cost">$120,000</div>
                            </div>
                        </div>
                        <div class="build-desc">+5 —Å—á–∞—Å—Ç—å—è (—Ä–∞–¥–∏—É—Å 3)</div>
                    </div>
                </div>
            </div>

            <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
            <div id="game-area">
                <div id="game-canvas-container">
                    <canvas id="game-canvas"></canvas>
                </div>
                <div id="zoom-info">–ó—É–º: 100% | –ö–æ–ª–µ—Å–æ –º—ã—à–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∞</div>
            </div>
        </div>
    </div>

    <!-- ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ==================== -->
    <div id="notifications"></div>

    <!-- ==================== –ö–ê–†–¢–û–ß–ö–ê –ó–î–ê–ù–ò–Ø ==================== -->
    <div id="building-info">
        <div class="info-header">
            <span class="info-title" id="info-title">–ó–¥–∞–Ω–∏–µ</span>
            <button class="info-close" onclick="closeBuildingInfo()">√ó</button>
        </div>
        <div id="info-content"></div>
        <button class="btn-demolish" onclick="demolishBuilding()">üóëÔ∏è –°–Ω–µ—Å—Ç–∏ –∑–¥–∞–Ω–∏–µ</button>
    </div>

    <!-- ==================== –ú–ï–°–Ø–ß–ù–´–ô –û–¢–ß–Å–¢ ==================== -->
    <div id="monthly-report">
        <div class="report-title" id="report-title">üìä –û—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü 1</div>
        <div class="report-section">
            <div class="report-section-title">–î–æ—Ö–æ–¥—ã</div>
            <div id="report-income"></div>
        </div>
        <div class="report-section">
            <div class="report-section-title">–†–∞—Å—Ö–æ–¥—ã</div>
            <div id="report-expenses"></div>
        </div>
        <div class="report-section">
            <div class="info-row">
                <span class="info-label">–ò—Ç–æ–≥–æ:</span>
                <span class="info-value" id="report-total">+$0</span>
            </div>
        </div>
        <button class="report-close" onclick="closeReport()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ====================
        const CONFIG = {
            CELL_SIZE: 40,
            GRID_WIDTH: 20,
            GRID_HEIGHT: 20,
            START_MONEY: 500000,
            MONTH_DURATION: 180000, // 3 –º–∏–Ω—É—Ç—ã = 180000 –º—Å
            DAY_DURATION: 6000, // 6 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å (30 –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ)
            SERVICE_RADIUS: 3
        };

        // –î–∞–Ω–Ω—ã–µ –æ –∑–¥–∞–Ω–∏—è—Ö
        const BUILDINGS = {
            // –î–æ—Ä–æ–≥–∏
            road: {
                name: '–î–æ—Ä–æ–≥–∞',
                type: 'road',
                cost: 1000,
                maintenance: 50,
                icon: 'üõ§Ô∏è',
                color: '#696969'
            },
            // –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å
            iron_factory: {
                name: '–ó–∞–≤–æ–¥ –∂–µ–ª–µ–∑–∞',
                type: 'industrial',
                cost: 50000,
                maintenance: 1000,
                income: 0,
                production: { iron: 10 },
                icon: 'üè≠',
                color: '#8B0000'
            },
            warehouse: {
                name: '–°–∫–ª–∞–¥',
                type: 'industrial',
                cost: 30000,
                maintenance: 500,
                income: 2000,
                icon: 'üì¶',
                color: '#8B0000'
            },
            goods_factory: {
                name: '–§–∞–±—Ä–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤',
                type: 'industrial',
                cost: 80000,
                maintenance: 1500,
                income: 5000,
                icon: '‚öôÔ∏è',
                color: '#8B0000'
            },
            // –ö–æ–º–º–µ—Ä—Ü–∏—è
            shop: {
                name: '–ú–∞–≥–∞–∑–∏–Ω',
                type: 'commercial',
                cost: 30000,
                maintenance: 500,
                income: 5000,
                icon: 'üè™',
                color: '#FFD700'
            },
            mall: {
                name: '–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä',
                type: 'commercial',
                cost: 150000,
                maintenance: 3000,
                income: 20000,
                icon: 'üè¨',
                color: '#FFD700'
            },
            cafe: {
                name: '–ö–∞—Ñ–µ',
                type: 'commercial',
                cost: 20000,
                maintenance: 300,
                income: 3000,
                icon: '‚òï',
                color: '#FFD700'
            },
            // –ñ–∏–ª–∞—è –∑–æ–Ω–∞
            house: {
                name: '–î–æ–º',
                type: 'residential',
                cost: 20000,
                maintenance: 200,
                residents: 4,
                taxMultiplier: 100,
                icon: 'üè†',
                color: '#32CD32'
            },
            apartment: {
                name: '–ú–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–π –¥–æ–º',
                type: 'residential',
                cost: 80000,
                maintenance: 800,
                residents: 20,
                taxMultiplier: 80,
                icon: 'üè¢',
                color: '#32CD32'
            },
            cottage: {
                name: '–≠–ª–∏—Ç–Ω—ã–π –∫–æ—Ç—Ç–µ–¥–∂',
                type: 'residential',
                cost: 100000,
                maintenance: 500,
                residents: 2,
                taxMultiplier: 500,
                icon: 'üè°',
                color: '#32CD32'
            },
            // –°–ª—É–∂–±—ã
            police: {
                name: '–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π —É—á–∞—Å—Ç–æ–∫',
                type: 'service',
                cost: 100000,
                maintenance: 2000,
                happinessBonus: 10,
                icon: 'üöî',
                color: '#9C27B0'
            },
            hospital: {
                name: '–ë–æ–ª—å–Ω–∏—Ü–∞',
                type: 'service',
                cost: 150000,
                maintenance: 3000,
                happinessBonus: 15,
                icon: 'üè•',
                color: '#9C27B0'
            },
            fire_station: {
                name: '–ü–æ–∂–∞—Ä–Ω–∞—è —á–∞—Å—Ç—å',
                type: 'service',
                cost: 120000,
                maintenance: 2500,
                happinessBonus: 5,
                icon: 'üöí',
                color: '#9C27B0'
            }
        };

        // ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ====================
        let gameState = {
            money: CONFIG.START_MONEY,
            month: 1,
            day: 1,
            grid: [], // 2D –º–∞—Å—Å–∏–≤ —è—á–µ–µ–∫
            buildings: [], // –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∑–¥–∞–Ω–∏–π
            resources: { iron: 0 }
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        let selectedBuilding = null;
        let selectedBuildingInfo = null;
        let isDrawingRoad = false;
        let canvas, ctx;
        let zoom = 1;
        let offsetX = 0, offsetY = 0;
        let isDragging = false;
        let dragStartX, dragStartY;
        let gameInterval = null;
        let dayInterval = null;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            if (localStorage.getItem('cityGame')) {
                document.getElementById('btn-continue').disabled = false;
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫ –º–µ–Ω—é
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
            document.querySelectorAll('.build-item').forEach(item => {
                item.addEventListener('click', () => selectBuilding(item));
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ canvas
            setupCanvasEvents();
        });

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ====================
        
        // –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
        function startNewGame() {
            gameState = {
                money: CONFIG.START_MONEY,
                month: 1,
                day: 1,
                grid: [],
                buildings: [],
                resources: { iron: 0 }
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏
            for (let y = 0; y < CONFIG.GRID_HEIGHT; y++) {
                gameState.grid[y] = [];
                for (let x = 0; x < CONFIG.GRID_WIDTH; x++) {
                    gameState.grid[y][x] = null;
                }
            }

            startGame();
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGame() {
            const saved = localStorage.getItem('cityGame');
            if (saved) {
                try {
                    gameState = JSON.parse(saved);
                    startGame();
                    showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                } catch (e) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!', 'error');
                }
            }
        }

        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
        function startGame() {
            document.getElementById('title-screen').classList.add('hidden');
            document.getElementById('game-container').classList.add('active');
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            updateUI();
            render();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            startGameTime();
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            localStorage.setItem('cityGame', JSON.stringify(gameState));
            showNotification('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
        }

        // –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
        function returnToMenu() {
            if (confirm('–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é? –ù–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
                stopGameTime();
                document.getElementById('game-container').classList.remove('active');
                document.getElementById('title-screen').classList.remove('hidden');
                
                if (localStorage.getItem('cityGame')) {
                    document.getElementById('btn-continue').disabled = false;
                }
            }
        }

        // ==================== –õ–û–ì–ò–ö–ê –í–†–ï–ú–ï–ù–ò ====================
        
        function startGameTime() {
            // –¢–∞–π–º–µ—Ä –¥–Ω–µ–π (–∫–∞–∂–¥—ã–µ 6 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å)
            dayInterval = setInterval(() => {
                gameState.day++;
                if (gameState.day > 30) {
                    gameState.day = 1;
                    processMonth();
                }
                updateUI();
            }, CONFIG.DAY_DURATION);
        }

        function stopGameTime() {
            if (dayInterval) clearInterval(dayInterval);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞
        function processMonth() {
            const report = calculateMonthlyReport();
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            gameState.money += report.total;
            gameState.month++;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç—á—ë—Ç
            showMonthlyReport(report);
            
            updateUI();
        }

        // ==================== –†–ê–°–ß–Å–¢ –≠–ö–û–ù–û–ú–ò–ö–ò ====================
        
        function calculateMonthlyReport() {
            let income = {
                industrial: 0,
                commercial: 0,
                taxes: 0,
                resources: 0
            };
            let expenses = {
                maintenance: 0
            };

            gameState.buildings.forEach(building => {
                const data = BUILDINGS[building.type];
                
                // –†–∞—Å—Ö–æ–¥—ã –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
                expenses.maintenance += data.maintenance;

                // –î–æ—Ö–æ–¥—ã
                if (data.type === 'industrial') {
                    if (data.income) income.industrial += data.income;
                    if (data.production) {
                        for (let res in data.production) {
                            const amount = data.production[res];
                            income.resources += amount * 100; // $100 –∑–∞ –µ–¥–∏–Ω–∏—Ü—É —Ä–µ—Å—É—Ä—Å–∞
                        }
                    }
                } else if (data.type === 'commercial') {
                    income.commercial += data.income;
                } else if (data.type === 'residential') {
                    const happiness = calculateHappiness(building);
                    const tax = Math.floor(happiness * data.taxMultiplier / 100) * data.residents;
                    income.taxes += tax;
                }
            });

            const totalIncome = income.industrial + income.commercial + income.taxes + income.resources;
            const totalExpenses = expenses.maintenance;

            return {
                income,
                expenses,
                totalIncome,
                totalExpenses,
                total: totalIncome - totalExpenses
            };
        }

        // –†–∞—Å—á—ë—Ç —Å—á–∞—Å—Ç—å—è –¥–ª—è –∂–∏–ª–æ–≥–æ –∑–¥–∞–Ω–∏—è
        function calculateHappiness(building) {
            let happiness = 50; // –ë–∞–∑–æ–≤–æ–µ —Å—á–∞—Å—Ç—å–µ

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª—É–∂–±—ã –≤ —Ä–∞–¥–∏—É—Å–µ
            gameState.buildings.forEach(b => {
                const data = BUILDINGS[b.type];
                if (data.type === 'service' && data.happinessBonus) {
                    const distance = Math.max(
                        Math.abs(b.x - building.x),
                        Math.abs(b.y - building.y)
                    );
                    if (distance <= CONFIG.SERVICE_RADIUS) {
                        happiness += data.happinessBonus;
                    }
                }
            });

            return Math.min(100, happiness);
        }

        // ==================== –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê ====================
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === 'tab-' + tabName);
            });
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–∫–∏
            selectedBuilding = null;
            document.querySelectorAll('.build-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function selectBuilding(item) {
            document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            selectedBuilding = item.dataset.building;
            
            showNotification(`–í—ã–±—Ä–∞–Ω–æ: ${BUILDINGS[selectedBuilding].name}`, 'info');
        }

        // ==================== CANVAS –ò –û–¢–†–ò–°–û–í–ö–ê ====================
        
        function resizeCanvas() {
            const container = document.getElementById('game-canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            render();
        }

        function setupCanvasEvents() {
            canvas.addEventListener('wheel', handleZoom);
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
            canvas.addEventListener('click', handleClick);
            canvas.addEventListener('contextmenu', e => e.preventDefault());
        }

        function handleZoom(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            const newZoom = Math.max(0.5, Math.min(2, zoom + delta));
            
            // –ó—É–º –∫ –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const worldX = (mouseX - offsetX) / zoom;
            const worldY = (mouseY - offsetY) / zoom;
            
            zoom = newZoom;
            
            offsetX = mouseX - worldX * zoom;
            offsetY = mouseY - worldY * zoom;
            
            document.getElementById('zoom-info').textContent = 
                `–ó—É–º: ${Math.round(zoom * 100)}% | –ö–æ–ª–µ—Å–æ –º—ã—à–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∞`;
            
            render();
        }

        function handleMouseDown(e) {
            if (e.button === 2 || e.button === 1) {
                // –ü—Ä–∞–≤–∞—è/—Å—Ä–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞ - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                isDragging = true;
                dragStartX = e.clientX - offsetX;
                dragStartY = e.clientY - offsetY;
                canvas.style.cursor = 'grabbing';
            } else if (e.button === 0 && selectedBuilding === 'road') {
                isDrawingRoad = true;
                placeBuilding(e);
            }
        }

        function handleMouseMove(e) {
            if (isDragging) {
                offsetX = e.clientX - dragStartX;
                offsetY = e.clientY - dragStartY;
                render();
            } else if (isDrawingRoad) {
                placeBuilding(e);
            } else {
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —è—á–µ–π–∫–∏ –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                render();
                highlightCell(e);
            }
        }

        function handleMouseUp(e) {
            isDragging = false;
            isDrawingRoad = false;
            canvas.style.cursor = 'crosshair';
        }

        function handleClick(e) {
            if (isDragging) return;
            
            const cell = getCellFromMouse(e);
            if (!cell) return;

            const existingBuilding = gameState.grid[cell.y]?.[cell.x];
            
            if (existingBuilding && !selectedBuilding) {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–¥–∞–Ω–∏–∏
                showBuildingInfo(existingBuilding, e);
            } else if (selectedBuilding && !existingBuilding) {
                // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∑–¥–∞–Ω–∏–µ
                placeBuilding(e);
            }
        }

        function getCellFromMouse(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const worldX = (mouseX - offsetX) / zoom;
            const worldY = (mouseY - offsetY) / zoom;
            
            const cellX = Math.floor(worldX / CONFIG.CELL_SIZE);
            const cellY = Math.floor(worldY / CONFIG.CELL_SIZE);
            
            if (cellX >= 0 && cellX < CONFIG.GRID_WIDTH && 
                cellY >= 0 && cellY < CONFIG.GRID_HEIGHT) {
                return { x: cellX, y: cellY };
            }
            return null;
        }

        function placeBuilding(e) {
            if (!selectedBuilding) return;
            
            const cell = getCellFromMouse(e);
            if (!cell) return;

            const buildingData = BUILDINGS[selectedBuilding];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞: —è—á–µ–π–∫–∞ —Å–≤–æ–±–æ–¥–Ω–∞?
            if (gameState.grid[cell.y][cell.x]) {
                if (!isDrawingRoad) {
                    showNotification('–Ø—á–µ–π–∫–∞ –∑–∞–Ω—è—Ç–∞!', 'error');
                }
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥?
            if (gameState.money < buildingData.cost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ä—è–¥–æ–º –µ—Å—Ç—å –¥–æ—Ä–æ–≥–∞? (–∫—Ä–æ–º–µ —Å–∞–º–∏—Ö –¥–æ—Ä–æ–≥)
            if (buildingData.type !== 'road' && !hasAdjacentRoad(cell.x, cell.y)) {
                showNotification('–ó–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä—è–¥–æ–º —Å –¥–æ—Ä–æ–≥–æ–π!', 'warning');
                return;
            }

            // –°—Ç—Ä–æ–∏–º!
            gameState.money -= buildingData.cost;
            
            const building = {
                type: selectedBuilding,
                x: cell.x,
                y: cell.y,
                id: Date.now() + Math.random()
            };
            
            gameState.grid[cell.y][cell.x] = building;
            gameState.buildings.push(building);
            
            updateUI();
            render();
            
            if (!isDrawingRoad) {
                showNotification(`${buildingData.name} –ø–æ—Å—Ç—Ä–æ–µ–Ω!`, 'success');
            }
        }

        function hasAdjacentRoad(x, y) {
            const directions = [[0, -1], [0, 1], [-1, 0], [1, 0]];
            for (let [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                if (nx >= 0 && nx < CONFIG.GRID_WIDTH && 
                    ny >= 0 && ny < CONFIG.GRID_HEIGHT) {
                    const cell = gameState.grid[ny][nx];
                    if (cell && BUILDINGS[cell.type].type === 'road') {
                        return true;
                    }
                }
            }
            return false;
        }

        function highlightCell(e) {
            if (!selectedBuilding) return;
            
            const cell = getCellFromMouse(e);
            if (!cell) return;

            const x = cell.x * CONFIG.CELL_SIZE * zoom + offsetX;
            const y = cell.y * CONFIG.CELL_SIZE * zoom + offsetY;
            const size = CONFIG.CELL_SIZE * zoom;

            ctx.strokeStyle = gameState.grid[cell.y][cell.x] ? '#f44336' : '#4CAF50';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y, size, size);
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –§–æ–Ω
            ctx.fillStyle = '#e8e4d9';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;

            for (let y = 0; y <= CONFIG.GRID_HEIGHT; y++) {
                const py = y * CONFIG.CELL_SIZE * zoom + offsetY;
                ctx.beginPath();
                ctx.moveTo(offsetX, py);
                ctx.lineTo(CONFIG.GRID_WIDTH * CONFIG.CELL_SIZE * zoom + offsetX, py);
                ctx.stroke();
            }

            for (let x = 0; x <= CONFIG.GRID_WIDTH; x++) {
                const px = x * CONFIG.CELL_SIZE * zoom + offsetX;
                ctx.beginPath();
                ctx.moveTo(px, offsetY);
                ctx.lineTo(px, CONFIG.GRID_HEIGHT * CONFIG.CELL_SIZE * zoom + offsetY);
                ctx.stroke();
            }

            // –ó–¥–∞–Ω–∏—è
            gameState.buildings.forEach(building => {
                const data = BUILDINGS[building.type];
                const x = building.x * CONFIG.CELL_SIZE * zoom + offsetX;
                const y = building.y * CONFIG.CELL_SIZE * zoom + offsetY;
                const size = CONFIG.CELL_SIZE * zoom;

                // –§–æ–Ω —è—á–µ–π–∫–∏
                ctx.fillStyle = data.color;
                ctx.fillRect(x + 2, y + 2, size - 4, size - 4);

                // –ò–∫–æ–Ω–∫–∞
                ctx.font = `${size * 0.5}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(data.icon, x + size / 2, y + size / 2);
            });

            // –†–∞–¥–∏—É—Å—ã —Å–ª—É–∂–± (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–ª—É–∂–±—ã)
            if (selectedBuilding && BUILDINGS[selectedBuilding].type === 'service') {
                gameState.buildings.forEach(b => {
                    if (BUILDINGS[b.type].type === 'service') {
                        drawServiceRadius(b);
                    }
                });
            }
        }

        function drawServiceRadius(building) {
            const data = BUILDINGS[building.type];
            const centerX = (building.x + 0.5) * CONFIG.CELL_SIZE * zoom + offsetX;
            const centerY = (building.y + 0.5) * CONFIG.CELL_SIZE * zoom + offsetY;
            const radius = (CONFIG.SERVICE_RADIUS + 0.5) * CONFIG.CELL_SIZE * zoom;

            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(156, 39, 176, 0.1)';
            ctx.fill();
            ctx.strokeStyle = 'rgba(156, 39, 176, 0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // ==================== –ò–ù–¢–ï–†–§–ï–ô–° ====================
        
        function updateUI() {
            // –ë–∞–ª–∞–Ω—Å
            const balanceEl = document.getElementById('balance-display');
            balanceEl.textContent = '$' + gameState.money.toLocaleString();
            balanceEl.classList.toggle('negative', gameState.money < 0);

            // –ú–µ—Å—è—Ü –∏ –¥–µ–Ω—å
            document.getElementById('month-display').textContent = `–ú–µ—Å—è—Ü ${gameState.month}`;
            document.getElementById('day-display').textContent = `(–î–µ–Ω—å ${gameState.day})`;

            // –ù–∞—Å–µ–ª–µ–Ω–∏–µ
            let population = 0;
            gameState.buildings.forEach(b => {
                const data = BUILDINGS[b.type];
                if (data.residents) population += data.residents;
            });
            document.getElementById('population-display').textContent = population.toLocaleString();
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            container.appendChild(notification);

            setTimeout(() => notification.remove(), 3000);
        }

        function showBuildingInfo(building, e) {
            selectedBuildingInfo = building;
            const data = BUILDINGS[building.type];
            const infoPanel = document.getElementById('building-info');
            
            document.getElementById('info-title').textContent = data.icon + ' ' + data.name;
            
            let content = `
                <div class="info-row">
                    <span class="info-label">–¢–∏–ø:</span>
                    <span class="info-value">${getTypeName(data.type)}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:</span>
                    <span class="info-value negative">-$${data.maintenance.toLocaleString()}/–º–µ—Å</span>
                </div>
            `;

            if (data.income) {
                content += `
                    <div class="info-row">
                        <span class="info-label">–î–æ—Ö–æ–¥:</span>
                        <span class="info-value positive">+$${data.income.toLocaleString()}/–º–µ—Å</span>
                    </div>
                `;
            }

            if (data.production) {
                for (let res in data.production) {
                    content += `
                        <div class="info-row">
                            <span class="info-label">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ:</span>
                            <span class="info-value positive">+${data.production[res]} ${res}/–º–µ—Å</span>
                        </div>
                    `;
                }
            }

            if (data.residents) {
                const happiness = calculateHappiness(building);
                const tax = Math.floor(happiness * data.taxMultiplier / 100) * data.residents;
                content += `
                    <div class="info-row">
                        <span class="info-label">–ñ–∏—Ç–µ–ª–∏:</span>
                        <span class="info-value">${data.residents}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–°—á–∞—Å—Ç—å–µ:</span>
                        <span class="info-value">${happiness}/100</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–ù–∞–ª–æ–≥–∏:</span>
                        <span class="info-value positive">+$${tax.toLocaleString()}/–º–µ—Å</span>
                    </div>
                `;
            }

            if (data.happinessBonus) {
                content += `
                    <div class="info-row">
                        <span class="info-label">–ë–æ–Ω—É—Å —Å—á–∞—Å—Ç—å—è:</span>
                        <span class="info-value positive">+${data.happinessBonus}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–†–∞–¥–∏—É—Å:</span>
                        <span class="info-value">${CONFIG.SERVICE_RADIUS} –∫–ª–µ—Ç–æ–∫</span>
                    </div>
                `;
            }

            document.getElementById('info-content').innerHTML = content;
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            infoPanel.style.left = Math.min(e.clientX + 10, window.innerWidth - 280) + 'px';
            infoPanel.style.top = Math.min(e.clientY + 10, window.innerHeight - 300) + 'px';
            infoPanel.classList.add('visible');
        }

        function closeBuildingInfo() {
            document.getElementById('building-info').classList.remove('visible');
            selectedBuildingInfo = null;
        }

        function demolishBuilding() {
            if (!selectedBuildingInfo) return;
            
            const building = selectedBuildingInfo;
            const data = BUILDINGS[building.type];
            
            // –í–æ–∑–≤—Ä–∞—Ç 50% —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            const refund = Math.floor(data.cost * 0.5);
            gameState.money += refund;
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–µ—Ç–∫–∏ –∏ —Å–ø–∏—Å–∫–∞
            gameState.grid[building.y][building.x] = null;
            gameState.buildings = gameState.buildings.filter(b => b.id !== building.id);
            
            closeBuildingInfo();
            updateUI();
            render();
            
            showNotification(`${data.name} —Å–Ω–µ—Å—ë–Ω. –í–æ–∑–≤—Ä–∞—Ç: $${refund.toLocaleString()}`, 'info');
        }

        function getTypeName(type) {
            const names = {
                road: '–î–æ—Ä–æ–≥–∞',
                industrial: '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å',
                commercial: '–ö–æ–º–º–µ—Ä—Ü–∏—è',
                residential: '–ñ–∏–ª–∞—è –∑–æ–Ω–∞',
                service: '–°–ª—É–∂–±–∞'
            };
            return names[type] || type;
        }

        // ==================== –ú–ï–°–Ø–ß–ù–´–ô –û–¢–ß–Å–¢ ====================
        
        function showMonthlyReport(report) {
            document.getElementById('report-title').textContent = 
                `üìä –û—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü ${gameState.month - 1}`;

            document.getElementById('report-income').innerHTML = `
                <div class="info-row">
                    <span class="info-label">–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å:</span>
                    <span class="info-value positive">+$${report.income.industrial.toLocaleString()}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ö–æ–º–º–µ—Ä—Ü–∏—è:</span>
                    <span class="info-value positive">+$${report.income.commercial.toLocaleString()}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ù–∞–ª–æ–≥–∏:</span>
                    <span class="info-value positive">+$${report.income.taxes.toLocaleString()}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ü—Ä–æ–¥–∞–∂–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:</span>
                    <span class="info-value positive">+$${report.income.resources.toLocaleString()}</span>
                </div>
            `;

            document.getElementById('report-expenses').innerHTML = `
                <div class="info-row">
                    <span class="info-label">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:</span>
                    <span class="info-value negative">-$${report.expenses.maintenance.toLocaleString()}</span>
                </div>
            `;

            const totalEl = document.getElementById('report-total');
            totalEl.textContent = (report.total >= 0 ? '+' : '') + '$' + report.total.toLocaleString();
            totalEl.className = 'info-value ' + (report.total >= 0 ? 'positive' : 'negative');

            document.getElementById('monthly-report').classList.add('visible');
        }

        function closeReport() {
            document.getElementById('monthly-report').classList.remove('visible');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–µ–π –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        document.addEventListener('click', (e) => {
            const infoPanel = document.getElementById('building-info');
            if (infoPanel.classList.contains('visible') && 
                !infoPanel.contains(e.target) && 
                e.target.tagName === 'CANVAS') {
                // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –Ω–µ –Ω–∞ –∑–¥–∞–Ω–∏–µ
                const cell = getCellFromMouse(e);
                if (cell && !gameState.grid[cell.y]?.[cell.x]) {
                    closeBuildingInfo();
                }
            }
        });
    </script>
</body>
</html>